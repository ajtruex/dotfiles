{"version":3,"sources":["../src/exp.ts"],"names":["packageJSON","require","Api","setClientName","version","ApiV2","Command","prototype","urlOpts","addOptions","allowOffline","option","helpGroup","name","commands","length","__helpGroup","parent","longDescription","__longDescription","pad","str","width","len","Math","max","Array","join","humanReadableArgName","arg","nameOutput","variadic","required","breakSentence","input","replace","trim","prepareCommands","filter","cmd","getenv","boolish","includes","map","i","args","_args","description","_description","nameWithAlias","_name","usage","commandsStr","argsStr","arguments","_usage","helpInformation","desc","replaceAll","argsDescription","_argsDescription","padWidth","push","forEach","cmdName","_alias","chalk","bold","dim","commandHelp","options","optionHelp","string","search","split","helpGroups","command","groupName","groupOrder","Set","Object","keys","subGroupOrder","core","eas","sortSubGroupWithOrder","group","order","sortedCommands","key","shift","index","findIndex","item","startsWith","splice","concat","sortedGroups","noArgsCmd","noArgsCmdArgs","wrappedDescription","paddedName","program","on","asyncAction","asyncFn","skipUpdateCheck","action","checkCliVersionAsync","e","offline","Config","Analytics","flush","err","AbortCommandError","isCommandError","log","error","message","_isApiError","red","isXDLError","isJsonFileError","code","addNewLineIfNone","stacktrace","formatStackTrace","stack","gray","process","exit","getStringBetweenParens","value","regExp","matches","exec","focusLastPathComponent","parts","last","pop","current","treeStackLines","line","first","branch","Boolean","asyncActionProjectDir","projectDir","opts","cwd","path","resolve","config","green","cyan","newLine","pathToConfig","fs","existsSync","relativeInput","relative","formattedPath","reset","nestedWarn","helpCommand","ConfigUtils","setCustomConfigPath","logLines","msg","logFn","logStackTrace","chunk","nestedLogFn","traceInfo","JSON","parse","isLibraryFrame","stackFrames","lastAppCodeFrameIndex","lastFrameIndexToLog","min","unloggedFrames","match","printNewLineBeforeNextLog","logWithLevel","level","bunyan","INFO","includesStack","nested","WARN","warn","nestedError","bar","PackagerLogsStream","projectRoot","onStartBuildBundle","ProgressBar","total","clear","complete","incomplete","setBundleProgressBar","onProgressBuildBundle","percent","ticks","curr","tick","onFinishBuildBundle","startTime","endTime","terminate","getTime","updateLogs","updater","newLogChunks","newLogChunk","issueId","issueCleared","ProjectUtils","attachLoggerStream","stream","write","tag","type","checkConfig","Project","currentStatus","spinner","start","setSpinner","status","Doctor","validateWithoutNetworkAsync","skipSDKVersionRequirement","FATAL","Error","stop","runAsync","programName","setSegmentNodeKey","setVersionName","_registerLogs","UserManager","setInteractiveAuthenticationCallback","loginOrRegisterAsync","env","SERVER_URL","serverUrl","parsedUrl","url","port","parseInt","hostname","api","host","developerTool","subCommand","availableCommands","suggestion","find","commandName","nonInteractive","stdin","isTTY","argv","help","updateIsAvailable","latest","deprecated","update","checkForUpdateAsync","borderColor","padding","NotificationCode","START_LOADING","simpleSpinner","STOP_LOADING","DOWNLOAD_CLI_PROGRESS","ERROR","Logger","notifications","addStream","global","writePathAsync","Binaries","writePathToUserSettingsAsync","run","Promise","all","catch"],"mappings":"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","sourcesContent":["import bunyan from '@expo/bunyan';\nimport * as ConfigUtils from '@expo/config';\nimport simpleSpinner from '@expo/simple-spinner';\nimport {\n  Analytics,\n  Api,\n  ApiV2,\n  Binaries,\n  Config,\n  Doctor,\n  Logger,\n  LogRecord,\n  LogUpdater,\n  NotificationCode,\n  PackagerLogsStream,\n  Project,\n  ProjectUtils,\n  UserManager,\n} from '@expo/xdl';\nimport boxen from 'boxen';\nimport chalk from 'chalk';\nimport program, { Command } from 'commander';\nimport fs from 'fs';\nimport getenv from 'getenv';\nimport leven from 'leven';\nimport findLastIndex from 'lodash/findLastIndex';\nimport ora from 'ora';\nimport path from 'path';\nimport ProgressBar from 'progress';\nimport stripAnsi from 'strip-ansi';\nimport url from 'url';\n\nimport { AbortCommandError } from './CommandError';\nimport { loginOrRegisterAsync } from './accounts';\nimport { registerCommands } from './commands';\nimport log from './log';\nimport update from './update';\nimport urlOpts from './urlOpts';\n\n// We use require() to exclude package.json from TypeScript's analysis since it lives outside the\n// src directory and would change the directory structure of the emitted files under the build\n// directory\nconst packageJSON = require('../package.json');\n\nApi.setClientName(packageJSON.version);\nApiV2.setClientName(packageJSON.version);\n\n// The following prototyped functions are not used here, but within in each file found in `./commands`\n// Extending commander to easily add more options to certain command line arguments\nCommand.prototype.urlOpts = function () {\n  urlOpts.addOptions(this);\n  return this;\n};\n\nCommand.prototype.allowOffline = function () {\n  this.option('--offline', 'Allows this command to run while offline');\n  return this;\n};\n\n// Add support for logical command groupings\nCommand.prototype.helpGroup = function (name: string) {\n  if (this.commands[this.commands.length - 1]) {\n    this.commands[this.commands.length - 1].__helpGroup = name;\n  } else {\n    this.parent.helpGroup(name);\n  }\n  return this;\n};\n\n// A longer description that will be displayed then the command is used with --help\nCommand.prototype.longDescription = function (name: string) {\n  if (this.commands[this.commands.length - 1]) {\n    this.commands[this.commands.length - 1].__longDescription = name;\n  } else {\n    this.parent.longDescription(name);\n  }\n  return this;\n};\n\nfunction pad(str: string, width: number): string {\n  // Pulled from commander for overriding\n  const len = Math.max(0, width - stripAnsi(str).length);\n  return str + Array(len + 1).join(' ');\n}\n\nfunction humanReadableArgName(arg: any): string {\n  // Pulled from commander for overriding\n  const nameOutput = arg.name + (arg.variadic === true ? '...' : '');\n  return arg.required ? `<${nameOutput}>` : `[${nameOutput}]`;\n}\n\nfunction breakSentence(input: string): string {\n  // Break a sentence by the word after a max character count\n  return input.replace(/(.{1,72})(?:\\n|$| )/g, '$1\\n').trim();\n}\n\nCommand.prototype.prepareCommands = function () {\n  return this.commands\n    .filter(function (cmd: Command) {\n      // Display all commands with EXPO_DEBUG, otherwise use the noHelp option.\n      if (getenv.boolish('EXPO_DEBUG', false)) {\n        return true;\n      }\n      return !['internal', 'eas'].includes(cmd.__helpGroup);\n    })\n    .map(function (cmd: Command, i: number) {\n      const args = cmd._args.map(humanReadableArgName).join(' ');\n\n      const description = cmd._description;\n      // Remove alias. We still show this with --help on the command.\n      // const alias = cmd._alias;\n      // const nameWithAlias = cmd._name + (alias ? '|' + alias : '');\n      const nameWithAlias = cmd._name;\n      return [\n        nameWithAlias +\n          // Remove the redundant [options] string that's shown after every command.\n          // (cmd.options.length ? ' [options]' : '') +\n          (args ? ' ' + args : ''),\n        breakSentence(description),\n        cmd.__helpGroup ?? 'misc',\n      ];\n    });\n};\n\n/**\n * Set / get the command usage `str`.\n *\n * @param {String} str\n * @return {String|Command}\n * @api public\n */\n\n// @ts-ignore\nCommand.prototype.usage = function (str: string) {\n  var args = this._args.map(function (arg: any[]) {\n    return humanReadableArgName(arg);\n  });\n\n  const commandsStr = this.commands.length ? '[command]' : '';\n  const argsStr = this._args.length ? args.join(' ') : '';\n\n  let usage = commandsStr + argsStr;\n  if (usage.length) usage += ' ';\n  usage += '[options]';\n\n  if (arguments.length === 0) {\n    return this._usage || usage;\n  }\n  this._usage = str;\n\n  return this;\n};\n\nCommand.prototype.helpInformation = function () {\n  let desc: string[] = [];\n  // Use the long description if available, otherwise use the regular description.\n  const description = this.__longDescription ?? this._description;\n  if (description) {\n    desc = [replaceAll(breakSentence(description), '\\n', pad('\\n', 3)), ''];\n\n    const argsDescription = this._argsDescription;\n    if (argsDescription && this._args.length) {\n      const width = this.padWidth();\n      desc.push('Arguments:');\n      desc.push('');\n      this._args.forEach(({ name }: { name: string }) => {\n        desc.push('  ' + pad(name, width) + '  ' + argsDescription[name]);\n      });\n      desc.push('');\n    }\n  }\n\n  let cmdName = this._name;\n  if (this._alias) {\n    // Here is the only place we show the command alias\n    cmdName = `${cmdName}|${this._alias}`;\n  }\n\n  // Dim the options to keep things consistent.\n  const usage = `${chalk.bold`Usage:`} ${cmdName} ${chalk.dim(this.usage())}\\n`;\n\n  const commandHelp = '' + this.commandHelp();\n\n  const options = [chalk.bold`Options:`, '\\n' + this.optionHelp().replace(/^/gm, '    '), ''];\n\n  // return ['', usage, ...desc, ...options, commandHelp].join('\\n') + '\\n';\n  return ['', usage, ...desc, ...options, commandHelp].join(pad('\\n', 3)) + '\\n';\n};\n\nfunction replaceAll(string: string, search: string, replace: string): string {\n  return string.split(search).join(replace);\n}\n\n// Extended the help renderer to add a custom format and groupings.\nCommand.prototype.commandHelp = function () {\n  if (!this.commands.length) {\n    return '';\n  }\n  const width: number = this.padWidth();\n  const commands: string[][] = this.prepareCommands();\n\n  const helpGroups: Record<string, string[][]> = {};\n\n  // Sort commands into helpGroups\n  for (const command of commands) {\n    const groupName = command[2];\n    if (!helpGroups[groupName]) {\n      helpGroups[groupName] = [];\n    }\n    helpGroups[groupName].push(command);\n  }\n\n  const groupOrder = [\n    ...new Set([\n      'auth',\n      'core',\n      'client',\n      'info',\n      'publish',\n      'build',\n      'credentials',\n      'eas',\n      'notifications',\n      'url',\n      'webhooks',\n      'upload',\n      'eject',\n      'experimental',\n      'internal',\n      // add any others and remove duplicates\n      ...Object.keys(helpGroups),\n    ]),\n  ];\n\n  const subGroupOrder: Record<string, string[]> = {\n    core: ['init', 'start', 'start:web', 'publish', 'export'],\n    eas: ['eas:credentials'],\n  };\n\n  const sortSubGroupWithOrder = (groupName: string, group: string[][]): string[][] => {\n    const order: string[] = subGroupOrder[groupName];\n    if (!order?.length) {\n      return group;\n    }\n\n    const sortedCommands: string[][] = [];\n\n    while (order.length) {\n      const key = order.shift()!;\n      const index = group.findIndex(item => item[0].startsWith(key));\n      if (index >= 0) {\n        const [item] = group.splice(index, 1);\n        sortedCommands.push(item);\n      }\n    }\n\n    return sortedCommands.concat(group);\n  };\n\n  // Reverse the groups\n  const sortedGroups: Record<string, string[][]> = {};\n  while (groupOrder.length) {\n    const group = groupOrder.shift()!;\n    if (group in helpGroups) {\n      sortedGroups[group] = helpGroups[group];\n    }\n  }\n\n  // Render everything.\n  return [\n    '' + chalk.bold('Commands:'),\n    '',\n    // Render all of the groups.\n    Object.keys(sortedGroups)\n      .map(groupName => {\n        // Sort subgroups that have a defined order\n        const group = sortSubGroupWithOrder(groupName, helpGroups[groupName]);\n        return (\n          group\n            // Render the command and description\n            .map(([cmd, description]: string[]) => {\n              // Dim the arguments that come after the command, this makes scanning a bit easier.\n              let [noArgsCmd, ...noArgsCmdArgs] = cmd.split(' ');\n              if (noArgsCmdArgs.length) {\n                noArgsCmd += ` ${chalk.dim(noArgsCmdArgs.join(' '))}`;\n              }\n\n              // Word wrap the description.\n              let wrappedDescription = description;\n              if (description) {\n                // Ensure the wrapped description appears on the same padded line.\n                wrappedDescription = '  ' + replaceAll(description, '\\n', pad('\\n', width + 3));\n              }\n\n              const paddedName = wrappedDescription ? pad(noArgsCmd, width) : noArgsCmd;\n              return paddedName + wrappedDescription;\n            })\n            .join('\\n')\n            .replace(/^/gm, '    ')\n        );\n      })\n      // Double new line to add spacing between groups\n      .join('\\n\\n'),\n    '',\n  ].join('\\n');\n};\n\nprogram.on('--help', () => {\n  log(`  Run a command with --help for more info 💡`);\n  log(`    $ expo start --help`);\n  log();\n});\n\nexport type Action = (...args: any[]) => void;\n\n// asyncAction is a wrapper for all commands/actions to be executed after commander is done\n// parsing the command input\nCommand.prototype.asyncAction = function (asyncFn: Action, skipUpdateCheck: boolean) {\n  return this.action(async (...args: any[]) => {\n    if (!skipUpdateCheck) {\n      try {\n        await checkCliVersionAsync();\n      } catch (e) {}\n    }\n\n    try {\n      const options = args[args.length - 1];\n      if (options.offline) {\n        Config.offline = true;\n      }\n\n      await asyncFn(...args);\n      // After a command, flush the analytics queue so the program will not have any active timers\n      // This allows node js to exit immediately\n      Analytics.flush();\n    } catch (err) {\n      // TODO: Find better ways to consolidate error messages\n      if (err instanceof AbortCommandError) {\n        // Do nothing when a prompt is cancelled.\n      } else if (err.isCommandError) {\n        log.error(err.message);\n      } else if (err._isApiError) {\n        log.error(chalk.red(err.message));\n      } else if (err.isXDLError) {\n        log.error(err.message);\n      } else if (err.isJsonFileError) {\n        if (err.code === 'EJSONEMPTY') {\n          // Empty JSON is an easy bug to debug. Often this is thrown for package.json or app.json being empty.\n          log.error(err.message);\n        } else {\n          log.addNewLineIfNone();\n          log.error(err.message);\n          const stacktrace = formatStackTrace(err.stack, this.name());\n          log.error(chalk.gray(stacktrace));\n        }\n      } else {\n        log.error(err.message);\n        log.error(chalk.gray(err.stack));\n      }\n\n      process.exit(1);\n    }\n  });\n};\n\nfunction getStringBetweenParens(value: string): string {\n  const regExp = /\\(([^)]+)\\)/;\n  const matches = regExp.exec(value);\n  if (matches && matches?.length > 1) {\n    return matches[1];\n  }\n  return value;\n}\n\nfunction focusLastPathComponent(value: string): string {\n  const parts = value.split('/');\n  if (parts.length > 1) {\n    const last = parts.pop();\n    const current = chalk.dim(parts.join('/') + '/');\n    return `${current}${last}`;\n  }\n  return chalk.dim(value);\n}\n\nfunction formatStackTrace(stacktrace: string, command: string): string {\n  const treeStackLines: string[][] = [];\n  for (const line of stacktrace.split('\\n')) {\n    const [first, ...parts] = line.trim().split(' ');\n    // Remove at -- we'll use a branch instead.\n    if (first === 'at') {\n      treeStackLines.push(parts);\n    }\n  }\n\n  return treeStackLines\n    .map((parts, index) => {\n      let first = parts.shift();\n      let last = parts.pop();\n\n      // Replace anonymous with command name\n      if (first === 'Command.<anonymous>') {\n        first = chalk.bold(`expo ${command}`);\n      } else if (first?.startsWith('Object.')) {\n        // Remove extra JS types from function names\n        first = first.split('Object.').pop()!;\n      } else if (first?.startsWith('Function.')) {\n        // Remove extra JS types from function names\n        first = first.split('Function.').pop()!;\n      } else if (first?.startsWith('/')) {\n        // If the first element is a path\n        first = focusLastPathComponent(getStringBetweenParens(first));\n      }\n\n      if (last) {\n        last = focusLastPathComponent(getStringBetweenParens(last));\n      }\n      const branch = (index === treeStackLines.length - 1 ? '└' : '├') + '─';\n      return ['   ', branch, first, ...parts, last].filter(Boolean).join(' ');\n    })\n    .join('\\n');\n}\n\n// asyncActionProjectDir captures the projectDirectory from the command line,\n// setting it to cwd if it is not provided.\n// Commands such as `start` and `publish` use this.\n// It does several things:\n// - Everything in asyncAction\n// - Checks if the user is logged in or out\n// - Checks for updates\n// - Attaches the bundling logger\n// - Checks if the project directory is valid or not\n// - Runs AsyncAction with the projectDir as an argument\nCommand.prototype.asyncActionProjectDir = function (\n  asyncFn: Action,\n  options: { checkConfig?: boolean; skipSDKVersionRequirement?: boolean } = {}\n) {\n  this.option('--config [file]', 'Specify a path to app.json or app.config.js');\n  return this.asyncAction(async (projectDir: string, ...args: any[]) => {\n    const opts = args[0];\n\n    if (!projectDir) {\n      projectDir = process.cwd();\n    } else {\n      projectDir = path.resolve(process.cwd(), projectDir);\n    }\n\n    if (opts.config) {\n      // @ts-ignore: This guards against someone passing --config without a path.\n      if (opts.config === true) {\n        log.addNewLineIfNone();\n        log('Please specify your custom config path:');\n        log(log.chalk.green(`  expo ${this.name()} --config ${log.chalk.cyan(`<app-config>`)}`));\n        log.newLine();\n        process.exit(1);\n      }\n\n      const pathToConfig = path.resolve(process.cwd(), opts.config);\n      // Warn the user when the custom config path they provided does not exist.\n      if (!fs.existsSync(pathToConfig)) {\n        const relativeInput = path.relative(process.cwd(), opts.config);\n        const formattedPath = log.chalk\n          .reset(pathToConfig)\n          .replace(relativeInput, log.chalk.bold(relativeInput));\n        log.addNewLineIfNone();\n        log.nestedWarn(`Custom config file does not exist:\\n${formattedPath}`);\n        log.newLine();\n        const helpCommand = log.chalk.green(`expo ${this.name()} --help`);\n        log(`Run ${helpCommand} for more info`);\n        log.newLine();\n        process.exit(1);\n        // throw new Error(`File at provided config path does not exist: ${pathToConfig}`);\n      }\n      ConfigUtils.setCustomConfigPath(projectDir, pathToConfig);\n    }\n\n    const logLines = (msg: any, logFn: (...args: any[]) => void) => {\n      if (typeof msg === 'string') {\n        for (const line of msg.split('\\n')) {\n          logFn(line);\n        }\n      } else {\n        logFn(msg);\n      }\n    };\n\n    const logStackTrace = (\n      chunk: LogRecord,\n      logFn: (...args: any[]) => void,\n      nestedLogFn: (...args: any[]) => void\n    ) => {\n      let traceInfo;\n      try {\n        traceInfo = JSON.parse(chunk.msg);\n      } catch (e) {\n        return logFn(chunk.msg);\n      }\n\n      const { message, stack } = traceInfo;\n      log.addNewLineIfNone();\n      logFn(chalk.bold(message));\n\n      const isLibraryFrame = (line: string) => {\n        return line.startsWith('node_modules');\n      };\n\n      const stackFrames: string[] = stack.split('\\n').filter((line: string) => line);\n      const lastAppCodeFrameIndex = findLastIndex(stackFrames, (line: string) => {\n        return !isLibraryFrame(line);\n      });\n      let lastFrameIndexToLog = Math.min(\n        stackFrames.length - 1,\n        lastAppCodeFrameIndex + 2 // show max two more frames after last app code frame\n      );\n      let unloggedFrames = stackFrames.length - lastFrameIndexToLog;\n\n      // If we're only going to exclude one frame, just log them all\n      if (unloggedFrames === 1) {\n        lastFrameIndexToLog = stackFrames.length - 1;\n        unloggedFrames = 0;\n      }\n\n      for (let i = 0; i <= lastFrameIndexToLog; i++) {\n        const line = stackFrames[i];\n        if (!line) {\n          continue;\n        } else if (line.match(/react-native\\/.*YellowBox.js/)) {\n          continue;\n        }\n\n        if (line.startsWith('node_modules')) {\n          nestedLogFn('- ' + line);\n        } else {\n          nestedLogFn('* ' + line);\n        }\n      }\n\n      if (unloggedFrames > 0) {\n        nestedLogFn(`- ... ${unloggedFrames} more stack frames from framework internals`);\n      }\n\n      log.printNewLineBeforeNextLog();\n    };\n\n    const logWithLevel = (chunk: LogRecord) => {\n      if (!chunk.msg) {\n        return;\n      }\n      if (chunk.level <= bunyan.INFO) {\n        if (chunk.includesStack) {\n          logStackTrace(chunk, log, log.nested);\n        } else {\n          logLines(chunk.msg, log);\n        }\n      } else if (chunk.level === bunyan.WARN) {\n        if (chunk.includesStack) {\n          logStackTrace(chunk, log.warn, log.nestedWarn);\n        } else {\n          logLines(chunk.msg, log.warn);\n        }\n      } else {\n        if (chunk.includesStack) {\n          logStackTrace(chunk, log.error, log.nestedError);\n        } else {\n          logLines(chunk.msg, log.error);\n        }\n      }\n    };\n\n    let bar: ProgressBar | null;\n    // eslint-disable-next-line no-new\n    new PackagerLogsStream({\n      projectRoot: projectDir,\n      onStartBuildBundle: () => {\n        bar = new ProgressBar('Building JavaScript bundle [:bar] :percent', {\n          width: 64,\n          total: 100,\n          clear: true,\n          complete: '=',\n          incomplete: ' ',\n        });\n\n        log.setBundleProgressBar(bar);\n      },\n      onProgressBuildBundle: (percent: number) => {\n        if (!bar || bar.complete) return;\n        const ticks = percent - bar.curr;\n        ticks > 0 && bar.tick(ticks);\n      },\n      onFinishBuildBundle: (err, startTime, endTime) => {\n        if (bar && !bar.complete) {\n          bar.tick(100 - bar.curr);\n        }\n\n        if (bar) {\n          log.setBundleProgressBar(null);\n          bar.terminate();\n          bar = null;\n\n          if (err) {\n            log(chalk.red('Failed building JavaScript bundle.'));\n          } else {\n            log(\n              chalk.green(\n                `Finished building JavaScript bundle in ${\n                  endTime.getTime() - startTime.getTime()\n                }ms.`\n              )\n            );\n          }\n        }\n      },\n      updateLogs: (updater: LogUpdater) => {\n        const newLogChunks = updater([]);\n        newLogChunks.forEach((newLogChunk: LogRecord) => {\n          if (newLogChunk.issueId && newLogChunk.issueCleared) {\n            return;\n          }\n          logWithLevel(newLogChunk);\n        });\n      },\n    });\n\n    // needed for validation logging to function\n    ProjectUtils.attachLoggerStream(projectDir, {\n      stream: {\n        write: (chunk: LogRecord) => {\n          if (chunk.tag === 'device') {\n            logWithLevel(chunk);\n          }\n        },\n      },\n      type: 'raw',\n    });\n\n    // The existing CLI modules only pass one argument to this function, so skipProjectValidation\n    // will be undefined in most cases. we can explicitly pass a truthy value here to avoid\n    // validation (eg for init)\n    //\n    // If the packager/manifest server is running and healthy, there is no need\n    // to rerun Doctor because the directory was already checked previously\n    // This is relevant for command such as `send`\n    if (options.checkConfig && (await Project.currentStatus(projectDir)) !== 'running') {\n      const spinner = ora('Making sure project is set up correctly...').start();\n      log.setSpinner(spinner);\n      // validate that this is a good projectDir before we try anything else\n\n      const status = await Doctor.validateWithoutNetworkAsync(projectDir, {\n        skipSDKVersionRequirement: options.skipSDKVersionRequirement,\n      });\n      if (status === Doctor.FATAL) {\n        throw new Error(`There is an error with your project. See above logs for information.`);\n      }\n      spinner.stop();\n      log.setSpinner(null);\n    }\n\n    // the existing CLI modules only pass one argument to this function, so skipProjectValidation\n    // will be undefined in most cases. we can explicitly pass a truthy value here to avoid validation (eg for init)\n\n    return asyncFn(projectDir, ...args);\n  });\n};\n\nfunction runAsync(programName: string) {\n  try {\n    // Setup analytics\n    Analytics.setSegmentNodeKey('vGu92cdmVaggGA26s3lBX6Y5fILm8SQ7');\n    Analytics.setVersionName(packageJSON.version);\n    _registerLogs();\n\n    UserManager.setInteractiveAuthenticationCallback(loginOrRegisterAsync);\n\n    if (process.env.SERVER_URL) {\n      let serverUrl = process.env.SERVER_URL;\n      if (!serverUrl.startsWith('http')) {\n        serverUrl = `http://${serverUrl}`;\n      }\n      const parsedUrl = url.parse(serverUrl);\n      const port = parseInt(parsedUrl.port || '', 10);\n      if (parsedUrl.hostname && port) {\n        Config.api.host = parsedUrl.hostname;\n        Config.api.port = port;\n      } else {\n        throw new Error('Environment variable SERVER_URL is not a valid url');\n      }\n    }\n\n    Config.developerTool = packageJSON.name;\n\n    // Setup our commander instance\n    program.name(programName);\n    program\n      .version(packageJSON.version)\n      .option('--non-interactive', 'Fail, if an interactive prompt would be required to continue.');\n\n    // Load each module found in ./commands by 'registering' it with our commander instance\n    registerCommands(program);\n\n    program.on('command:detach', () => {\n      log.warn('To eject your project to ExpoKit (previously \"detach\"), use `expo eject`.');\n      process.exit(0);\n    });\n\n    program.on('command:*', subCommand => {\n      let msg = `\"${subCommand}\" is not an expo command. See \"expo --help\" for the full list of commands.`;\n      const availableCommands = program.commands.map((cmd: Command) => cmd._name);\n      // finding the best match whose edit distance is less than 40% of their length.\n      const suggestion = availableCommands.find(\n        (commandName: string) => leven(commandName, subCommand[0]) < commandName.length * 0.4\n      );\n      if (suggestion) {\n        msg = `\"${subCommand}\" is not an expo command -- did you mean ${suggestion}?\\n See \"expo --help\" for the full list of commands.`;\n      }\n      log.warn(msg);\n    });\n\n    if (typeof program.nonInteractive === 'undefined') {\n      // Commander doesn't initialize boolean args with default values.\n      program.nonInteractive = !process.stdin.isTTY;\n    }\n\n    program.parse(process.argv);\n\n    // Show help when no sub-command specified\n    if (program.args.length === 0) {\n      program.help();\n    }\n  } catch (e) {\n    log.error(e);\n    throw e;\n  }\n}\n\nasync function checkCliVersionAsync() {\n  const { updateIsAvailable, current, latest, deprecated } = await update.checkForUpdateAsync();\n  if (updateIsAvailable) {\n    log.nestedWarn(\n      boxen(\n        chalk.green(`There is a new version of ${packageJSON.name} available (${latest}).\nYou are currently using ${packageJSON.name} ${current}\nInstall expo-cli globally using the package manager of your choice;\nfor example: \\`npm install -g ${packageJSON.name}\\` to get the latest version`),\n        { borderColor: 'green', padding: 1 }\n      )\n    );\n  }\n\n  if (deprecated) {\n    log.nestedWarn(\n      boxen(\n        chalk.red(\n          `This version of expo-cli is not supported anymore.\nIt's highly recommended to update to the newest version.\n\nThe API endpoints used in this version of expo-cli might not exist,\nany interaction with Expo servers may result in unexpected behaviour.`\n        ),\n        { borderColor: 'red', padding: 1 }\n      )\n    );\n  }\n}\n\nfunction _registerLogs() {\n  const stream = {\n    stream: {\n      write: (chunk: any) => {\n        if (chunk.code) {\n          switch (chunk.code) {\n            case NotificationCode.START_LOADING:\n              simpleSpinner.start();\n              return;\n            case NotificationCode.STOP_LOADING:\n              simpleSpinner.stop();\n              return;\n            case NotificationCode.DOWNLOAD_CLI_PROGRESS:\n              return;\n          }\n        }\n\n        if (chunk.level === bunyan.INFO) {\n          log(chunk.msg);\n        } else if (chunk.level === bunyan.WARN) {\n          log.warn(chunk.msg);\n        } else if (chunk.level >= bunyan.ERROR) {\n          log.error(chunk.msg);\n        }\n      },\n    },\n    type: 'raw',\n  };\n\n  Logger.notifications.addStream(stream);\n  Logger.global.addStream(stream);\n}\n\nasync function writePathAsync() {\n  const subCommand = process.argv[2];\n  if (subCommand === 'prepare-detached-build') {\n    // This is being run from Android Studio or Xcode. Don't want to write PATH in this case.\n    return;\n  }\n\n  await Binaries.writePathToUserSettingsAsync();\n}\n\n// This is the entry point of the CLI\nexport function run(programName: string) {\n  (async function () {\n    await Promise.all([writePathAsync(), runAsync(programName)]);\n  })().catch(e => {\n    log.error('Uncaught Error', e);\n    process.exit(1);\n  });\n}\n"],"file":"exp.js"}