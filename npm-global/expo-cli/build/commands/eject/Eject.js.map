{"version":3,"sources":["../../../src/commands/eject/Eject.ts"],"names":["ejectAsync","projectRoot","options","platforms","process","platform","push","exp","pkg","ensureConfigAsync","tempDir","temporary","directory","includes","log","warn","chalk","bold","newLine","hasNewProjectFiles","needsPodInstall","createNativeProjectsFromTemplateAsync","isSyncing","shouldInstall","install","packageManager","CreateApp","resolvePackageManager","npm","yarn","installNodeDependenciesAsync","clean","configureIOSStepAsync","configureAndroidStepAsync","podsInstalled","installCocoaPodsAsync","warnIfDependenciesRequireAdditionalSetupAsync","nested","WarningAggregator","hasWarningsIOS","hasWarningsAndroid","installCmd","hasOwnProperty","dim","fallback","text","applyingIOSConfigStep","logNewSection","ConfigWarningAggregator","stopAndPersist","symbol","red","succeed","cleanJsDepsStep","fs","remove","installJsDepsStep","fail","exit","applyingAndroidConfigStep","copyPathsFromTemplate","templatePath","paths","copiedPaths","skippedPaths","targetPath","projectPath","path","join","existsSync","copySync","config","dynamicConfigPath","staticConfigPath","JsonFile","writeAsync","expo","json5","error","message","entryPoint","createFileHash","contents","crypto","createHash","update","digest","writeMetroConfig","updatingMetroConfigStep","sourceConfigPath","targetConfigPath","targetConfigPathExists","readFileSync","targetContents","Error","stop","clear","metro","e","validateBareTemplateExistsAsync","sdkVersion","sdkMajorVersionNumber","semver","major","templateSpec","pacote","manifest","code","updatePackageJSONAsync","defaultDependencies","defaultDevDependencies","dependencies","devDependencies","read","createDependenciesMap","updatingPackageJsonStep","scripts","start","ios","android","combinedDependencies","requiredDependencies","dependenciesKey","combinedDevDependencies","hasNewDependencies","hashForDependencyMap","hasNewDevDependencies","removedPkgMain","shouldDeleteMainField","main","writeFile","resolve","JSON","stringify","isPkgMainExpoAppEntry","startsWith","normalizeDependencyMap","deps","Object","keys","map","dependency","sort","depsList","depsString","getTargetPaths","targetPaths","cloneNativeDirectoriesAsync","creatingNativeProjectStep","Exp","extractTemplateAppAsync","results","GitIgnore","mergeGitIgnorePaths","length","didMerge","didClear","yellow","depsResults","outputMap","key","value","pkgsWithExtraSetup","packagesToWarn","filter","pkgName","warnAdditionalSetupStep","plural","forEach","stripDashes","s","replace","input"],"mappings":"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","sourcesContent":["import {\n  WarningAggregator as ConfigWarningAggregator,\n  ExpoConfig,\n  getConfig,\n  PackageJSONConfig,\n  WarningAggregator,\n} from '@expo/config';\nimport JsonFile, { JSONObject } from '@expo/json-file';\nimport { Exp } from '@expo/xdl';\nimport chalk from 'chalk';\nimport crypto from 'crypto';\nimport fs from 'fs-extra';\nimport npmPackageArg from 'npm-package-arg';\nimport pacote from 'pacote';\nimport path from 'path';\nimport semver from 'semver';\nimport temporary from 'tempy';\nimport terminalLink from 'terminal-link';\n\nimport log from '../../log';\nimport configureAndroidProjectAsync from '../apply/configureAndroidProjectAsync';\nimport configureIOSProjectAsync from '../apply/configureIOSProjectAsync';\nimport * as CreateApp from '../utils/CreateApp';\nimport * as GitIgnore from '../utils/GitIgnore';\nimport { usesOldExpoUpdatesAsync } from '../utils/ProjectUtils';\nimport { learnMore } from '../utils/TerminalLink';\nimport { logConfigWarningsAndroid, logConfigWarningsIOS } from '../utils/logConfigWarnings';\nimport maybeBailOnGitStatusAsync from '../utils/maybeBailOnGitStatusAsync';\nimport { getOrPromptForBundleIdentifier, getOrPromptForPackage } from './ConfigValidation';\n\ntype DependenciesMap = { [key: string]: string | number };\ntype PlatformsArray = ('ios' | 'android')[];\n\nexport type EjectAsyncOptions = {\n  verbose?: boolean;\n  force?: boolean;\n  install?: boolean;\n  packageManager?: 'npm' | 'yarn';\n};\n\n/**\n * Entry point into the eject process, delegates to other helpers to perform various steps.\n *\n * 1. Verify git is clean\n * 2. Create native projects (ios, android)\n * 3. Install node modules\n * 4. Apply config to native projects\n * 5. Install CocoaPods\n * 6. Log project info\n */\nexport async function ejectAsync(projectRoot: string, options?: EjectAsyncOptions): Promise<void> {\n  if (await maybeBailOnGitStatusAsync()) return;\n\n  const platforms: PlatformsArray = ['android'];\n\n  // Skip ejecting for iOS on Windows\n  if (process.platform !== 'win32') {\n    platforms.push('ios');\n  }\n\n  const { exp, pkg } = await ensureConfigAsync(projectRoot);\n  const tempDir = temporary.directory();\n\n  if (!platforms.includes('ios')) {\n    log.warn(\n      `⚠️  Skipping generating the iOS native project files. Run ${chalk.bold(\n        'expo eject'\n      )} again from macOS or Linux to generate the iOS project.`\n    );\n    log.newLine();\n  }\n\n  const { hasNewProjectFiles, needsPodInstall } = await createNativeProjectsFromTemplateAsync(\n    projectRoot,\n    exp,\n    pkg,\n    tempDir,\n    platforms\n  );\n  // Set this to true when we can detect that the user is running eject to sync new changes rather than ejecting to bare.\n  // This will be used to prevent the node modules from being nuked every time.\n  const isSyncing = !hasNewProjectFiles;\n\n  // Install node modules\n  const shouldInstall = options?.install !== false;\n\n  const packageManager = CreateApp.resolvePackageManager({\n    install: shouldInstall,\n    npm: options?.packageManager === 'npm',\n    yarn: options?.packageManager === 'yarn',\n  });\n\n  if (shouldInstall) {\n    await installNodeDependenciesAsync(projectRoot, packageManager, { clean: !isSyncing });\n  }\n\n  // Apply Expo config to native projects\n  if (platforms.includes('ios')) {\n    await configureIOSStepAsync(projectRoot);\n  }\n\n  if (platforms.includes('android')) {\n    await configureAndroidStepAsync(projectRoot);\n  }\n\n  // Install CocoaPods\n  let podsInstalled: boolean = false;\n  // err towards running pod install less because it's slow and users can easily run npx pod-install afterwards.\n  if (platforms.includes('ios') && shouldInstall && needsPodInstall) {\n    podsInstalled = await CreateApp.installCocoaPodsAsync(projectRoot);\n  }\n\n  await warnIfDependenciesRequireAdditionalSetupAsync(pkg, options);\n\n  log.newLine();\n  log.nested(`➡️  ${chalk.bold('Next steps')}`);\n\n  if (WarningAggregator.hasWarningsIOS() || WarningAggregator.hasWarningsAndroid()) {\n    log.nested(\n      `- 👆 Review the logs above and look for any warnings (⚠️ ) that might need follow-up.`\n    );\n  }\n\n  // Log a warning about needing to install node modules\n  if (options?.install === false) {\n    const installCmd = packageManager === 'npm' ? 'npm install' : 'yarn';\n    log.nested(`- ⚠️  Install node modules: ${log.chalk.bold(installCmd)}`);\n  }\n  if (!podsInstalled) {\n    log.nested(\n      `- 🍫 When CocoaPods is installed, initialize the project workspace: ${chalk.bold(\n        'npx pod-install'\n      )}`\n    );\n  }\n  log.nested(\n    `- 💡 You may want to run ${chalk.bold(\n      'npx @react-native-community/cli doctor'\n    )} to help install any tools that your app may need to run your native projects.`\n  );\n  log.nested(\n    `- 🔑 Download your Android keystore (if you're not sure if you need to, just run the command and see): ${chalk.bold(\n      'expo fetch:android:keystore'\n    )}`\n  );\n\n  if (exp.hasOwnProperty('assetBundlePatterns')) {\n    log.nested(\n      `- 📁 The property ${chalk.bold(\n        `assetBundlePatterns`\n      )} does not have the same effect in the bare workflow. ${log.chalk.dim(\n        learnMore('https://docs.expo.io/bare/updating-your-app/#embedding-assets')\n      )}`\n    );\n  }\n\n  if (await usesOldExpoUpdatesAsync(projectRoot)) {\n    log.nested(\n      `- 🚀 ${\n        (terminalLink(\n          'expo-updates',\n          'https://github.com/expo/expo/blob/master/packages/expo-updates/README.md'\n        ),\n        {\n          fallback: (text: string) => text,\n        })\n      } has been configured in your project. Before you do a release build, make sure you run ${chalk.bold(\n        'expo publish'\n      )}. ${log.chalk.dim(learnMore('https://expo.fyi/release-builds-with-expo-updates'))}`\n    );\n  }\n\n  if (hasNewProjectFiles) {\n    log.newLine();\n    log.nested(`☑️  ${chalk.bold('When you are ready to run your project')}`);\n    log.nested(\n      'To compile and run your project in development, execute one of the following commands:'\n    );\n\n    if (platforms.includes('ios')) {\n      log.nested(`- ${chalk.bold(packageManager === 'npm' ? 'npm run ios' : 'yarn ios')}`);\n    }\n\n    if (platforms.includes('android')) {\n      log.nested(`- ${chalk.bold(packageManager === 'npm' ? 'npm run android' : 'yarn android')}`);\n    }\n\n    log.nested(`- ${chalk.bold(packageManager === 'npm' ? 'npm run web' : 'yarn web')}`);\n  }\n}\n\nasync function configureIOSStepAsync(projectRoot: string) {\n  const applyingIOSConfigStep = CreateApp.logNewSection('iOS config syncing');\n  await configureIOSProjectAsync(projectRoot);\n  if (ConfigWarningAggregator.hasWarningsIOS()) {\n    applyingIOSConfigStep.stopAndPersist({\n      symbol: '⚠️ ',\n      text: chalk.red('iOS config synced with warnings that should be fixed:'),\n    });\n    logConfigWarningsIOS();\n  } else {\n    applyingIOSConfigStep.succeed('iOS config synced');\n  }\n}\n\n/**\n * Wraps PackageManager to install node modules and adds CLI logs.\n *\n * @param projectRoot\n */\nasync function installNodeDependenciesAsync(\n  projectRoot: string,\n  packageManager: 'yarn' | 'npm',\n  { clean = true }: { clean: boolean }\n) {\n  if (clean) {\n    // This step can take a couple seconds, if the installation logs are enabled (with EXPO_DEBUG) then it\n    // ends up looking odd to see \"Installing JavaScript dependencies\" for ~5 seconds before the logs start showing up.\n    const cleanJsDepsStep = CreateApp.logNewSection('Cleaning JavaScript dependencies.');\n    // nuke the node modules\n    // TODO: this is substantially slower, we should find a better alternative to ensuring the modules are installed.\n    await fs.remove('node_modules');\n    cleanJsDepsStep.succeed('Cleaned JavaScript dependencies.');\n  }\n\n  const installJsDepsStep = CreateApp.logNewSection('Installing JavaScript dependencies.');\n\n  try {\n    await CreateApp.installNodeDependenciesAsync(projectRoot, packageManager);\n    installJsDepsStep.succeed('Installed JavaScript dependencies.');\n  } catch {\n    installJsDepsStep.fail(\n      chalk.red(\n        `Something went wrong installing JavaScript dependencies, check your ${packageManager} logfile or run ${chalk.bold(\n          `${packageManager} install`\n        )} again manually.`\n      )\n    );\n    // TODO: actually show the error message from the package manager! :O\n    process.exit(1);\n  }\n}\n\nasync function configureAndroidStepAsync(projectRoot: string) {\n  const applyingAndroidConfigStep = CreateApp.logNewSection('Android config syncing');\n  await configureAndroidProjectAsync(projectRoot);\n  if (ConfigWarningAggregator.hasWarningsAndroid()) {\n    applyingAndroidConfigStep.stopAndPersist({\n      symbol: '⚠️ ',\n      text: chalk.red('Android config synced with warnings that should be fixed:'),\n    });\n    logConfigWarningsAndroid();\n  } else {\n    applyingAndroidConfigStep.succeed('Android config synced');\n  }\n}\n\nfunction copyPathsFromTemplate(\n  projectRoot: string,\n  templatePath: string,\n  paths: string[]\n): [string[], string[]] {\n  const copiedPaths = [];\n  const skippedPaths = [];\n  for (const targetPath of paths) {\n    const projectPath = path.join(projectRoot, targetPath);\n    if (!fs.existsSync(projectPath)) {\n      copiedPaths.push(targetPath);\n      fs.copySync(path.join(templatePath, targetPath), projectPath);\n    } else {\n      skippedPaths.push(targetPath);\n    }\n  }\n  return [copiedPaths, skippedPaths];\n}\n\nasync function ensureConfigAsync(\n  projectRoot: string\n): Promise<{ exp: ExpoConfig; pkg: PackageJSONConfig }> {\n  // We need the SDK version to proceed\n\n  let exp: ExpoConfig;\n  let pkg: PackageJSONConfig;\n  try {\n    const config = getConfig(projectRoot);\n    exp = config.exp;\n    pkg = config.pkg;\n\n    // If no config exists in the file system then we should generate one so the process doesn't fail.\n    if (!config.dynamicConfigPath && !config.staticConfigPath) {\n      // Don't check for a custom config path because the process should fail if a custom file doesn't exist.\n      // Write the generated config.\n      // writeConfigJsonAsync(projectRoot, config.exp);\n      await JsonFile.writeAsync(\n        // TODO: Write to app.config.json because it's easier to convert to a js config file.\n        path.join(projectRoot, 'app.json'),\n        { expo: (config.exp as unknown) as JSONObject },\n        { json5: false }\n      );\n    }\n  } catch (error) {\n    // TODO(Bacon): Currently this is already handled in the command\n    log();\n    log(chalk.red(error.message));\n    log();\n    process.exit(1);\n  }\n\n  // Prompt for the Android package first because it's more strict than the bundle identifier\n  // this means you'll have a better chance at matching the bundle identifier with the package name.\n  await getOrPromptForPackage(projectRoot);\n  await getOrPromptForBundleIdentifier(projectRoot);\n\n  if (exp.entryPoint) {\n    delete exp.entryPoint;\n    log(`- expo.entryPoint is not needed and has been removed.`);\n  }\n\n  return { exp, pkg };\n}\n\nfunction createFileHash(contents: string): string {\n  // this doesn't need to be secure, the shorter the better.\n  return crypto.createHash('sha1').update(contents).digest('hex');\n}\n\nfunction writeMetroConfig({\n  projectRoot,\n  pkg,\n  tempDir,\n}: {\n  projectRoot: string;\n  pkg: PackageJSONConfig;\n  tempDir: string;\n}) {\n  /**\n   * Add metro config, or warn if metro config already exists. The developer will need to add the\n   * hashAssetFiles plugin manually.\n   */\n\n  const updatingMetroConfigStep = CreateApp.logNewSection('Adding Metro bundler configuration');\n\n  try {\n    const sourceConfigPath = path.join(tempDir, 'metro.config.js');\n    const targetConfigPath = path.join(projectRoot, 'metro.config.js');\n    const targetConfigPathExists = fs.existsSync(targetConfigPath);\n    if (targetConfigPathExists) {\n      // Prevent re-runs from throwing an error if the metro config hasn't been modified.\n      const contents = createFileHash(fs.readFileSync(targetConfigPath, 'utf8'));\n      const targetContents = createFileHash(fs.readFileSync(sourceConfigPath, 'utf8'));\n      if (contents !== targetContents) {\n        throw new Error('Existing Metro configuration found; not overwriting.');\n      } else {\n        // Nothing to change, hide the step and exit.\n        updatingMetroConfigStep.stop();\n        updatingMetroConfigStep.clear();\n        return;\n      }\n    } else if (\n      fs.existsSync(path.join(projectRoot, 'metro.config.json')) ||\n      pkg.metro ||\n      fs.existsSync(path.join(projectRoot, 'rn-cli.config.js'))\n    ) {\n      throw new Error('Existing Metro configuration found; not overwriting.');\n    }\n\n    fs.copySync(sourceConfigPath, targetConfigPath);\n    updatingMetroConfigStep.succeed('Added Metro bundler configuration.');\n  } catch (e) {\n    updatingMetroConfigStep.stopAndPersist({\n      symbol: '⚠️ ',\n      text: chalk.red('Metro bundler configuration not applied:'),\n    });\n    log.nested(`- ${e.message}`);\n    log.nested(\n      `- You will need to add the ${chalk.bold(\n        'hashAssetFiles'\n      )} plugin to your Metro configuration. ${log.chalk.dim(\n        learnMore('https://docs.expo.io/bare/installing-updates/')\n      )}`\n    );\n    log.newLine();\n  }\n}\n\nasync function validateBareTemplateExistsAsync(sdkVersion: string): Promise<npmPackageArg.Result> {\n  // Validate that the template exists\n  const sdkMajorVersionNumber = semver.major(sdkVersion);\n  const templateSpec = npmPackageArg(`expo-template-bare-minimum@sdk-${sdkMajorVersionNumber}`);\n  try {\n    await pacote.manifest(templateSpec);\n  } catch (e) {\n    if (e.code === 'E404') {\n      throw new Error(\n        `Unable to eject because an eject template for SDK ${sdkMajorVersionNumber} was not found.`\n      );\n    } else {\n      throw e;\n    }\n  }\n\n  return templateSpec;\n}\n\ntype DependenciesModificationResults = {\n  hasNewDependencies: boolean;\n  hasNewDevDependencies: boolean;\n};\n\nasync function updatePackageJSONAsync({\n  projectRoot,\n  tempDir,\n  pkg,\n}: {\n  projectRoot: string;\n  tempDir: string;\n  pkg: PackageJSONConfig;\n}): Promise<DependenciesModificationResults> {\n  let defaultDependencies: any = {};\n  let defaultDevDependencies: any = {};\n  const { dependencies, devDependencies } = JsonFile.read(path.join(tempDir, 'package.json'));\n  defaultDependencies = createDependenciesMap(dependencies);\n  defaultDevDependencies = createDependenciesMap(devDependencies);\n  /**\n   * Update package.json scripts - `npm start` should default to `react-native\n   * start` rather than `expo start` after ejecting, for example.\n   */\n  // NOTE(brentvatne): Removing spaces between steps for now, add back when\n  // there is some additional context for steps\n  const updatingPackageJsonStep = CreateApp.logNewSection(\n    'Updating your package.json scripts, dependencies, and main file'\n  );\n  if (!pkg.scripts) {\n    pkg.scripts = {};\n  }\n  pkg.scripts.start = 'react-native start';\n  pkg.scripts.ios = 'react-native run-ios';\n  pkg.scripts.android = 'react-native run-android';\n\n  /**\n   * Update package.json dependencies by combining the dependencies in the project we are ejecting\n   * with the dependencies in the template project. Does the same for devDependencies.\n   *\n   * - The template may have some dependencies beyond react/react-native/react-native-unimodules,\n   *   for example RNGH and Reanimated. We should prefer the version that is already being used\n   *   in the project for those, but swap the react/react-native/react-native-unimodules versions\n   *   with the ones in the template.\n   * - The same applies to expo-updates -- since some native project configuration may depend on the\n   *   version, we should always use the version of expo-updates in the template.\n   */\n\n  const combinedDependencies: DependenciesMap = createDependenciesMap({\n    ...defaultDependencies,\n    ...pkg.dependencies,\n  });\n\n  const requiredDependencies = ['react', 'react-native-unimodules', 'react-native', 'expo-updates'];\n\n  for (const dependenciesKey of requiredDependencies) {\n    combinedDependencies[dependenciesKey] = defaultDependencies[dependenciesKey];\n  }\n  const combinedDevDependencies: DependenciesMap = createDependenciesMap({\n    ...defaultDevDependencies,\n    ...pkg.devDependencies,\n  });\n\n  // Only change the dependencies if the normalized hash changes, this helps to reduce meaningless changes.\n  const hasNewDependencies =\n    hashForDependencyMap(pkg.dependencies) !== hashForDependencyMap(combinedDependencies);\n  const hasNewDevDependencies =\n    hashForDependencyMap(pkg.devDependencies) !== hashForDependencyMap(combinedDevDependencies);\n  // Save the dependencies\n  if (hasNewDependencies) {\n    pkg.dependencies = combinedDependencies;\n  }\n  if (hasNewDevDependencies) {\n    pkg.devDependencies = combinedDevDependencies;\n  }\n\n  /**\n   * Add new app entry points\n   */\n  let removedPkgMain;\n  // Check that the pkg.main doesn't match:\n  // - ./node_modules/expo/AppEntry\n  // - ./node_modules/expo/AppEntry.js\n  // - node_modules/expo/AppEntry.js\n  // - expo/AppEntry.js\n  // - expo/AppEntry\n  if (shouldDeleteMainField(pkg.main)) {\n    // Save the custom\n    removedPkgMain = pkg.main;\n    delete pkg.main;\n  }\n  await fs.writeFile(path.resolve(projectRoot, 'package.json'), JSON.stringify(pkg, null, 2));\n\n  updatingPackageJsonStep.succeed(\n    'Updated package.json and added index.js entry point for iOS and Android.'\n  );\n  if (removedPkgMain) {\n    log(\n      `- Removed ${chalk.bold(\n        `\"main\": \"${removedPkgMain}\"`\n      )} from package.json because we recommend using index.js as main instead.`\n    );\n    log.newLine();\n  }\n\n  return {\n    hasNewDependencies,\n    hasNewDevDependencies,\n  };\n}\n\nexport function shouldDeleteMainField(main?: any): boolean {\n  if (!main || !isPkgMainExpoAppEntry(main)) {\n    return false;\n  }\n\n  return !main?.startsWith('index.');\n}\n\nfunction normalizeDependencyMap(deps: DependenciesMap): string[] {\n  return Object.keys(deps)\n    .map(dependency => `${dependency}@${deps[dependency]}`)\n    .sort();\n}\n\nexport function hashForDependencyMap(deps: DependenciesMap): string {\n  const depsList = normalizeDependencyMap(deps);\n  const depsString = depsList.join('\\n');\n  return createFileHash(depsString);\n}\n\nexport function getTargetPaths(pkg: PackageJSONConfig, platforms: PlatformsArray) {\n  const targetPaths: string[] = [...platforms];\n\n  // Only create index.js if we are going to replace the app \"main\" entry point\n  if (shouldDeleteMainField(pkg.main)) {\n    targetPaths.push('index.js');\n  }\n\n  return targetPaths;\n}\n\n/**\n * Extract the template and copy the ios and android directories over to the project directory.\n *\n * @return `true` if any project files were created.\n */\nasync function cloneNativeDirectoriesAsync({\n  projectRoot,\n  tempDir,\n  exp,\n  pkg,\n  platforms,\n}: {\n  projectRoot: string;\n  tempDir: string;\n  exp: Pick<ExpoConfig, 'name' | 'sdkVersion'>;\n  pkg: PackageJSONConfig;\n  platforms: PlatformsArray;\n}): Promise<string[]> {\n  const templateSpec = await validateBareTemplateExistsAsync(exp.sdkVersion!);\n\n  // NOTE(brentvatne): Removing spaces between steps for now, add back when\n  // there is some additional context for steps\n  const creatingNativeProjectStep = CreateApp.logNewSection(\n    'Creating native project directories (./ios and ./android) and updating .gitignore'\n  );\n\n  const targetPaths = getTargetPaths(pkg, platforms);\n\n  let copiedPaths: string[] = [];\n  let skippedPaths: string[] = [];\n  try {\n    await Exp.extractTemplateAppAsync(templateSpec, tempDir, exp);\n    [copiedPaths, skippedPaths] = copyPathsFromTemplate(projectRoot, tempDir, targetPaths);\n    const results = GitIgnore.mergeGitIgnorePaths(\n      path.join(projectRoot, '.gitignore'),\n      path.join(tempDir, '.gitignore')\n    );\n\n    let message = `Created native project${platforms.length > 1 ? 's' : ''}`;\n\n    if (skippedPaths.length) {\n      message += log.chalk.dim(\n        ` | ${skippedPaths.map(path => log.chalk.bold(`/${path}`)).join(', ')} already created`\n      );\n    }\n    if (!results?.didMerge) {\n      message += log.chalk.dim(` | gitignore already synced`);\n    } else if (results.didMerge && results.didClear) {\n      message += log.chalk.dim(` | synced gitignore`);\n    }\n    creatingNativeProjectStep.succeed(message);\n  } catch (e) {\n    log(chalk.red(e.message));\n    creatingNativeProjectStep.fail(\n      'Failed to create the native project - see the output above for more information.'\n    );\n    log(\n      chalk.yellow(\n        'You may want to delete the `./ios` and/or `./android` directories before running eject again.'\n      )\n    );\n    process.exit(1);\n  }\n\n  return copiedPaths;\n}\n\n/**\n *\n * @param projectRoot\n * @param tempDir\n *\n * @return `true` if the project is ejecting, and `false` if it's syncing.\n */\nasync function createNativeProjectsFromTemplateAsync(\n  projectRoot: string,\n  exp: ExpoConfig,\n  pkg: PackageJSONConfig,\n  tempDir: string,\n  platforms: PlatformsArray\n): Promise<\n  { hasNewProjectFiles: boolean; needsPodInstall: boolean } & DependenciesModificationResults\n> {\n  const copiedPaths = await cloneNativeDirectoriesAsync({\n    projectRoot,\n    tempDir,\n    exp,\n    pkg,\n    platforms,\n  });\n\n  writeMetroConfig({ projectRoot, pkg, tempDir });\n\n  const depsResults = await updatePackageJSONAsync({ projectRoot, tempDir, pkg });\n\n  return {\n    hasNewProjectFiles: !!copiedPaths.length,\n    // If the iOS folder changes or new packages are added, we should rerun pod install.\n    needsPodInstall:\n      copiedPaths.includes('ios') ||\n      depsResults.hasNewDependencies ||\n      depsResults.hasNewDevDependencies,\n    ...depsResults,\n  };\n}\n\n/**\n * Create an object of type DependenciesMap a dependencies object or throw if not valid.\n *\n * @param dependencies - ideally an object of type {[key]: string} - if not then this will error.\n */\nfunction createDependenciesMap(dependencies: any): DependenciesMap {\n  if (typeof dependencies !== 'object') {\n    throw new Error(`Dependency map is invalid, expected object but got ${typeof dependencies}`);\n  }\n\n  const outputMap: DependenciesMap = {};\n  if (!dependencies) return outputMap;\n\n  for (const key of Object.keys(dependencies)) {\n    const value = dependencies[key];\n    if (typeof value === 'string') {\n      outputMap[key] = value;\n    } else {\n      throw new Error(\n        `Dependency for key \\`${key}\\` should be a \\`string\\`, instead got: \\`{ ${key}: ${JSON.stringify(\n          value\n        )} }\\``\n      );\n    }\n  }\n  return outputMap;\n}\n\n/**\n * Some packages are not configured automatically on eject and may require\n * users to add some code, eg: to their AppDelegate.\n */\nasync function warnIfDependenciesRequireAdditionalSetupAsync(\n  pkg: PackageJSONConfig,\n  options?: EjectAsyncOptions\n): Promise<void> {\n  const pkgsWithExtraSetup: Record<string, string> = {\n    'expo-camera': 'https://github.com/expo/expo/tree/master/packages/expo-camera',\n    'expo-image-picker': 'https://github.com/expo/expo/tree/master/packages/expo-image-picker',\n    'lottie-react-native': 'https://github.com/react-native-community/lottie-react-native',\n    'expo-constants': `${chalk.bold(\n      'Constants.manifest'\n    )} is not available in the bare workflow. You should replace it with ${chalk.bold(\n      'Updates.manifest'\n    )}. ${log.chalk.dim(\n      learnMore('https://docs.expo.io/versions/latest/sdk/updates/#updatesmanifest')\n    )}`,\n  };\n  const packagesToWarn: string[] = Object.keys(pkg.dependencies).filter(\n    pkgName => pkgName in pkgsWithExtraSetup\n  );\n\n  if (packagesToWarn.length === 0) {\n    return;\n  }\n\n  log.newLine();\n  const warnAdditionalSetupStep = CreateApp.logNewSection(\n    'Checking if any additional setup steps are required for installed SDK packages.'\n  );\n\n  const plural = packagesToWarn.length > 1;\n\n  warnAdditionalSetupStep.stopAndPersist({\n    symbol: '⚠️ ',\n    text: chalk.red(\n      `Your app includes ${chalk.bold(`${packagesToWarn.length}`)} package${\n        plural ? 's' : ''\n      } that require${plural ? '' : 's'} additional setup in order to run:`\n    ),\n  });\n\n  packagesToWarn.forEach(pkgName => {\n    log.nested(`- ${chalk.bold(pkgName)}: ${pkgsWithExtraSetup[pkgName]}`);\n  });\n}\n\nexport function stripDashes(s: string): string {\n  return s.replace(/\\s|-/g, '');\n}\n\n/**\n * Returns true if the input string matches the default expo main field.\n *\n * - ./node_modules/expo/AppEntry\n * - ./node_modules/expo/AppEntry.js\n * - node_modules/expo/AppEntry.js\n * - expo/AppEntry.js\n * - expo/AppEntry\n *\n * @param input package.json main field\n */\nexport function isPkgMainExpoAppEntry(input?: string): boolean {\n  const main = input || '';\n  if (main.startsWith('./')) {\n    return main.includes('node_modules/expo/AppEntry');\n  }\n  return main.includes('expo/AppEntry');\n}\n"],"file":"Eject.js"}