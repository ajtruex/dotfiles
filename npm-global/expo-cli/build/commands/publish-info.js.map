{"version":3,"sources":["../../src/commands/publish-info.ts"],"names":["HORIZ_CELL_WIDTH_SMALL","HORIZ_CELL_WIDTH_BIG","program","command","alias","description","helpGroup","option","parseInt","asyncActionProjectDir","projectDir","options","result","raw","JSON","stringify","queryResult","length","sampleItem","generalTableString","table","printTableJson","fullName","headers","colWidths","bigCells","Set","forEach","header","has","push","resultRows","map","publication","publishedTime","tableString","printTableJsonArray","Error","checkConfig","publishId","detail"],"mappings":"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","sourcesContent":["import dateFormat from 'dateformat';\n\nimport log from '../log';\nimport {\n  DetailOptions,\n  getPublicationDetailAsync,\n  getPublishHistoryAsync,\n  HistoryOptions,\n  printPublicationDetailAsync,\n  Publication,\n} from './utils/PublishUtils';\nimport * as table from './utils/cli-table';\n\nconst HORIZ_CELL_WIDTH_SMALL = 15;\nconst HORIZ_CELL_WIDTH_BIG = 40;\n\nexport default (program: any) => {\n  program\n    .command('publish:history [path]')\n    .alias('ph')\n    .description(\"Log the project's releases\")\n    .helpGroup('publish')\n    .option(\n      '-c, --release-channel <channel-name>',\n      'Filter by release channel. If this flag is not included, the most recent publications will be shown.'\n    )\n    .option('--count <number-of-logs>', 'Number of logs to view, maximum 100, default 5.', parseInt)\n    .option(\n      '-p, --platform <ios|android>',\n      'Filter by platform, android or ios. Defaults to both platforms.'\n    )\n    .option('-s, --sdk-version <version>', 'Filter by SDK version e.g. 35.0.0')\n    .option('-r, --raw', 'Produce some raw output.')\n    .asyncActionProjectDir(\n      async (projectDir: string, options: HistoryOptions) => {\n        const result = await getPublishHistoryAsync(projectDir, options);\n\n        if (options.raw) {\n          log(JSON.stringify(result));\n          return;\n        }\n\n        if (result.queryResult && result.queryResult.length > 0) {\n          // Print general publication info\n          const sampleItem = result.queryResult[0]; // get a sample item\n          const generalTableString = table.printTableJson(\n            {\n              fullName: sampleItem.fullName,\n            },\n            'General Info'\n          );\n          log(generalTableString);\n\n          // Print info specific to each publication\n          const headers = [\n            'publishedTime',\n            'appVersion',\n            'sdkVersion',\n            'platform',\n            'channel',\n            'publicationId',\n          ];\n\n          // colWidths contains the cell size of each header\n          const colWidths: number[] = [];\n          const bigCells = new Set(['publicationId', 'publishedTime', 'channel']);\n          headers.forEach(header => {\n            if (bigCells.has(header)) {\n              colWidths.push(HORIZ_CELL_WIDTH_BIG);\n            } else {\n              colWidths.push(HORIZ_CELL_WIDTH_SMALL);\n            }\n          });\n          const resultRows: Publication[] = result.queryResult.map((publication: Publication) => ({\n            ...publication,\n            publishedTime: dateFormat(publication.publishedTime, 'ddd mmm dd yyyy HH:MM:ss Z'),\n          }));\n          const tableString = table.printTableJsonArray(headers, resultRows, colWidths);\n          log(tableString);\n        } else {\n          throw new Error('No records found matching your query.');\n        }\n      },\n      { checkConfig: true }\n    );\n  program\n    .command('publish:details [path]')\n    .alias('pd')\n    .description('Log details of a published release')\n    .helpGroup('publish')\n    .option('--publish-id <publish-id>', 'Publication id. (Required)')\n    .option('-r, --raw', 'Produce some raw output.')\n    .asyncActionProjectDir(\n      async (projectDir: string, options: DetailOptions) => {\n        if (!options.publishId) {\n          throw new Error('--publish-id must be specified.');\n        }\n\n        const detail = await getPublicationDetailAsync(projectDir, options);\n        await printPublicationDetailAsync(detail, options);\n      },\n      { checkConfig: true }\n    );\n};\n"],"file":"publish-info.js"}