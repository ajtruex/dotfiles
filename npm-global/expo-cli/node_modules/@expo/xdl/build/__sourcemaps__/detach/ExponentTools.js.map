{"version":3,"sources":["detach/ExponentTools.ts"],"names":["getManifestFileNameForSdkVersion","sdkVersion","parseSdkMajorVersion","getBundleFileNameForSdkVersion","expSdkVersion","Infinity","sdkMajorVersion","versionComponents","split","map","number","parseInt","_","saveUrlToPathAsync","url","path","timeout","response","axios","get","responseType","Promise","resolve","reject","stream","fs","createWriteStream","on","data","pipe","saveImageToPathAsync","projectRoot","pathOrURL","outPath","localPath","existsSync","copy","getManifestAsync","headers","options","buildPhaseLogger","logger","LoggerDetach","withFields","buildPhase","_retryPromise","replace","err","error","Error","info","JSON","stringify","fn","retries","spawnAsyncThrowError","command","args","stdio","cwd","process","pipeToLogger","promise","child","streams","stdout","stderr","loggerFields","spawnAsync","e","message","createSpawner","lastArg","length","optionsFromArg","pop","transformFileContentsAsync","filename","transform","fileString","readFile","newFileString","writeFile","manifestUsesSplashApi","manifest","platform","splash","ios","android","rimrafDontThrow","directory","removeSync","removeIfExists","file","remove","isDirectory","dir","statSync","getResolvedLocalesAsync","exp","locales","undefined","lang","localePath","Object","entries","s","parse","XDLError","regexFileAsync","regex","toString","deleteLinesInFileAsync","startRegex","endRegex","lines","filteredLines","inDeleteRange","i","match","push","join"],"mappings":"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","sourcesContent":["import { ExpoConfig, Platform } from '@expo/config';\nimport spawnAsyncQuiet, { SpawnOptions, SpawnResult } from '@expo/spawn-async';\nimport axios from 'axios';\nimport fs from 'fs-extra';\nimport isObject from 'lodash/isObject';\nimport path from 'path';\nimport { Readable } from 'stream';\n\nimport XDLError from '../XDLError';\nimport LoggerDetach, { Logger, pipeOutputToLogger } from './Logger';\n\nfunction getManifestFileNameForSdkVersion(sdkVersion: string) {\n  if (parseSdkMajorVersion(sdkVersion) < 39) {\n    return 'shell-app-manifest.json';\n  } else {\n    return 'app.manifest';\n  }\n}\n\nfunction getBundleFileNameForSdkVersion(sdkVersion: string) {\n  if (parseSdkMajorVersion(sdkVersion) < 39) {\n    return 'shell-app.bundle';\n  } else {\n    return 'app.bundle';\n  }\n}\n\nfunction parseSdkMajorVersion(expSdkVersion: string) {\n  // We assume that the unversioned SDK is the latest\n  if (expSdkVersion === 'UNVERSIONED') {\n    return Infinity;\n  }\n\n  let sdkMajorVersion = 0;\n  try {\n    const versionComponents = expSdkVersion.split('.').map(number => parseInt(number, 10));\n    sdkMajorVersion = versionComponents[0];\n  } catch (_) {}\n  return sdkMajorVersion;\n}\n\nasync function saveUrlToPathAsync(url: string, path: string, timeout = 20000) {\n  const response = await axios.get(url, { responseType: 'stream', timeout });\n\n  return new Promise(function (resolve, reject) {\n    const stream = fs.createWriteStream(path);\n    stream.on('close', resolve);\n    stream.on('error', reject);\n    response.data.on('error', reject).pipe(stream);\n  });\n}\n\nasync function saveImageToPathAsync(projectRoot: string, pathOrURL: string, outPath: string) {\n  const localPath = path.resolve(projectRoot, pathOrURL);\n\n  if (fs.existsSync(localPath)) {\n    await fs.copy(localPath, outPath);\n  } else {\n    await saveUrlToPathAsync(pathOrURL, outPath, 0);\n  }\n}\n\nasync function getManifestAsync(url: string, headers: any, options: any = {}) {\n  const buildPhaseLogger =\n    options.logger || LoggerDetach.withFields({ buildPhase: 'reading manifest' });\n\n  let response;\n  try {\n    response = await _retryPromise(() => axios.get(url.replace('exp://', 'http://'), { headers }));\n  } catch (err) {\n    buildPhaseLogger.error(err);\n    throw new Error('Failed to fetch manifest from www');\n  }\n\n  buildPhaseLogger.info('Using manifest:', JSON.stringify(response.data, null, 2));\n  return response.data;\n}\n\nasync function _retryPromise<T>(fn: (...args: any[]) => T, retries = 5): Promise<T> {\n  try {\n    return await fn();\n  } catch (err) {\n    if (retries-- > 0) {\n      return await _retryPromise(fn, retries);\n    } else {\n      throw err;\n    }\n  }\n}\n\nexport type AsyncSpawnOptions = SpawnOptions & {\n  loggerFields?: any;\n  pipeToLogger?: boolean | { stdout?: boolean; stderr?: boolean };\n  stdoutOnly?: boolean;\n  loggerLineTransformer?: (line: any) => any;\n};\n\nasync function spawnAsyncThrowError(\n  command: string,\n  args: string[],\n  options: AsyncSpawnOptions = {\n    stdio: 'inherit',\n    cwd: process.cwd(),\n  }\n): Promise<SpawnResult> {\n  const { pipeToLogger } = options;\n  if (pipeToLogger) {\n    options.stdio = 'pipe';\n    options.cwd = options.cwd || process.cwd();\n  }\n  const promise = spawnAsyncQuiet(command, args, options);\n  if (pipeToLogger && promise.child) {\n    const streams: { stdout?: Readable | null; stderr?: Readable | null } = {};\n    if (pipeToLogger === true || pipeToLogger.stdout) {\n      streams.stdout = promise.child.stdout;\n    }\n    if (pipeToLogger === true || pipeToLogger.stderr) {\n      streams.stderr = promise.child.stderr;\n    }\n    pipeOutputToLogger(streams, options.loggerFields, options);\n  }\n  return promise;\n}\n\nasync function spawnAsync(\n  command: string,\n  args: string[],\n  options: SpawnOptions\n): Promise<SpawnResult | void> {\n  try {\n    return await spawnAsyncThrowError(command, args, options);\n  } catch (e) {\n    LoggerDetach.error(e.message);\n  }\n}\n\nfunction createSpawner(buildPhase: string, logger?: Logger) {\n  return (command: string, ...args: any[]) => {\n    const lastArg = args[args.length - 1];\n    const optionsFromArg = isObject(lastArg) ? args.pop() : {};\n\n    const options = { ...optionsFromArg, pipeToLogger: true };\n    if (buildPhase) {\n      options.loggerFields = options.loggerFields ? options.loggerFields : {};\n      options.loggerFields = { ...options.loggerFields, buildPhase };\n    }\n\n    if (logger) {\n      logger.info('Executing command:', command, ...args);\n    }\n    return spawnAsyncThrowError(command, args, options);\n  };\n}\n\nasync function transformFileContentsAsync(\n  filename: string,\n  transform: (input: string) => string | null\n) {\n  const fileString = await fs.readFile(filename, 'utf8');\n  const newFileString = transform(fileString);\n  if (newFileString !== null) {\n    await fs.writeFile(filename, newFileString);\n  }\n}\n\nfunction manifestUsesSplashApi(manifest: ExpoConfig, platform: Platform) {\n  if (platform === 'ios') {\n    return manifest.splash || (manifest.ios && manifest.ios.splash);\n  }\n  if (platform === 'android') {\n    return manifest.splash || (manifest.android && manifest.android.splash);\n  }\n  return false;\n}\n\nfunction rimrafDontThrow(directory: string) {\n  fs.removeSync(directory);\n}\n\nasync function removeIfExists(file: string) {\n  await fs.remove(file);\n}\n\nfunction isDirectory(dir: string) {\n  try {\n    if (fs.statSync(dir).isDirectory()) {\n      return true;\n    }\n\n    return false;\n  } catch (e) {\n    return false;\n  }\n}\n\ntype LocaleMap = { [lang: string]: any };\n\nasync function getResolvedLocalesAsync(projectRoot: string, exp: ExpoConfig): Promise<LocaleMap> {\n  const locales: LocaleMap = {};\n  if (exp.locales !== undefined) {\n    for (const [lang, localePath] of Object.entries(exp.locales)) {\n      const s = await fs.readFile(path.resolve(projectRoot, localePath as string), 'utf8');\n      try {\n        locales[lang] = JSON.parse(s);\n      } catch (e) {\n        throw new XDLError('INVALID_JSON', JSON.stringify(e));\n      }\n    }\n  }\n  return locales;\n}\n\nasync function regexFileAsync(\n  regex: RegExp | string,\n  replace: string,\n  filename: string\n): Promise<void> {\n  const file = await fs.readFile(filename);\n  const fileString = file.toString();\n  await fs.writeFile(filename, fileString.replace(regex, replace));\n}\n\n// Matches sed /d behavior\nasync function deleteLinesInFileAsync(\n  startRegex: RegExp | string,\n  endRegex: RegExp | string,\n  filename: string\n): Promise<void> {\n  const file = await fs.readFile(filename);\n  const fileString = file.toString();\n  const lines = fileString.split(/\\r?\\n/);\n  const filteredLines = [];\n  let inDeleteRange = false;\n  for (let i = 0; i < lines.length; i++) {\n    if (lines[i].match(startRegex)) {\n      inDeleteRange = true;\n    }\n\n    if (!inDeleteRange) {\n      filteredLines.push(lines[i]);\n    }\n\n    if (inDeleteRange && lines[i].match(endRegex)) {\n      inDeleteRange = false;\n    }\n  }\n  await fs.writeFile(filename, filteredLines.join('\\n'));\n}\n\nexport {\n  isDirectory,\n  parseSdkMajorVersion,\n  saveUrlToPathAsync,\n  saveImageToPathAsync,\n  getManifestAsync,\n  rimrafDontThrow,\n  removeIfExists,\n  spawnAsyncThrowError,\n  spawnAsync,\n  transformFileContentsAsync,\n  manifestUsesSplashApi,\n  getResolvedLocalesAsync,\n  regexFileAsync,\n  deleteLinesInFileAsync,\n  createSpawner,\n  getManifestFileNameForSdkVersion,\n  getBundleFileNameForSdkVersion,\n};\n"],"file":"../../detach/ExponentTools.js","sourceRoot":"/@expo/xdl@58.0.16/src"}