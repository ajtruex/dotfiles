{"version":3,"sources":["UrlUtils.ts"],"names":["constructBundleUrlAsync","projectRoot","opts","requestHostname","constructUrlAsync","constructManifestUrlAsync","constructHostUriAsync","urlString","urlObj","url","parse","protocol","slashes","format","constructLogUrlAsync","baseUrl","urlType","constructUrlWithExtensionAsync","entryPoint","ext","defaultOpts","dev","minify","bundleUrl","hostType","mainModulePath","guessMainModulePath","queryParams","constructBundleQueryParamsAsync","constructPublishUrlAsync","constructSourceMapUrlAsync","constructAssetsUrlAsync","constructDebuggerHostAsync","encodeURIComponent","hasOwnProperty","strict","exp","supportsAssetPlugins","Versions","gteSdkVersion","usesAssetPluginsQueryParam","lteSdkVersion","pluginModule","constructWebAppUrlAsync","options","packagerInfo","ProjectSettings","readPackagerInfoAsync","webpackServerPort","https","readAsync","host","ip","address","isPackager","schema","joi","object","keys","any","valid","lanType","boolean","optional","urlRandomness","string","allow","error","validate","XDLError","toString","getPackagerOptsAsync","Object","assign","detach","schemes","Array","isArray","scheme","filter","firstScheme","hostname","port","proxyURL","process","env","EXPO_PACKAGER_PROXY_URL","EXPO_MANIFEST_PROXY_URL","parsedProxyURL","packagerPort","expoServerPort","Config","offline","EXPO_PACKAGER_HOSTNAME","trim","REACT_NATIVE_PACKAGER_HOSTNAME","os","ngrokUrl","packagerNgrokUrl","expoServerNgrokUrl","ProjectUtils","logWarning","clearNotification","pnu","url_","Error","replace","randomIdentifier","length","alphabet","result","i","j","Math","floor","random","c","substr","sevenDigitIdentifier","randomIdentifierForUser","username","someRandomness","join","domainify","s","toLowerCase","isHttps","validator","isURL","protocols"],"mappings":"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","sourcesContent":["import { getConfig, resolveModule } from '@expo/config';\nimport joi from '@hapi/joi';\nimport os from 'os';\nimport url from 'url';\nimport validator from 'validator';\n\nimport Config from './Config';\nimport * as ProjectSettings from './ProjectSettings';\nimport * as Versions from './Versions';\nimport XDLError from './XDLError';\nimport ip from './ip';\nimport * as ProjectUtils from './project/ProjectUtils';\n\nexport async function constructBundleUrlAsync(\n  projectRoot: string,\n  opts: any,\n  requestHostname?: string\n) {\n  return constructUrlAsync(projectRoot, opts, true, requestHostname);\n}\n\nexport async function constructManifestUrlAsync(\n  projectRoot: string,\n  opts?: any,\n  requestHostname?: string\n) {\n  return constructUrlAsync(projectRoot, opts, false, requestHostname);\n}\n\n// gets the base manifest URL and removes the scheme\nexport async function constructHostUriAsync(projectRoot: string, requestHostname?: string) {\n  const urlString = await constructUrlAsync(projectRoot, null, false, requestHostname);\n  // we need to use node's legacy urlObject api since the newer one doesn't like empty protocols\n  const urlObj = url.parse(urlString);\n  urlObj.protocol = '';\n  urlObj.slashes = false;\n  return url.format(urlObj);\n}\n\nexport async function constructLogUrlAsync(projectRoot: string, requestHostname?: string) {\n  const baseUrl = await constructUrlAsync(projectRoot, { urlType: 'http' }, false, requestHostname);\n  return `${baseUrl}/logs`;\n}\n\nexport async function constructUrlWithExtensionAsync(\n  projectRoot: string,\n  entryPoint: string,\n  ext: string,\n  requestHostname?: string,\n  opts?: object\n) {\n  const defaultOpts = {\n    dev: false,\n    minify: true,\n  };\n  opts = opts || defaultOpts;\n  let bundleUrl = await constructBundleUrlAsync(\n    projectRoot,\n    {\n      hostType: 'localhost',\n      urlType: 'http',\n    },\n    requestHostname\n  );\n\n  const mainModulePath = guessMainModulePath(entryPoint);\n  bundleUrl += `/${mainModulePath}.${ext}`;\n\n  const queryParams = await constructBundleQueryParamsAsync(projectRoot, opts);\n  return `${bundleUrl}?${queryParams}`;\n}\n\nexport async function constructPublishUrlAsync(\n  projectRoot: string,\n  entryPoint: string,\n  requestHostname?: string,\n  opts?: object\n) {\n  return await constructUrlWithExtensionAsync(\n    projectRoot,\n    entryPoint,\n    'bundle',\n    requestHostname,\n    opts\n  );\n}\n\nexport async function constructSourceMapUrlAsync(\n  projectRoot: string,\n  entryPoint: string,\n  requestHostname?: string\n) {\n  return await constructUrlWithExtensionAsync(projectRoot, entryPoint, 'map', requestHostname);\n}\n\nexport async function constructAssetsUrlAsync(\n  projectRoot: string,\n  entryPoint: string,\n  requestHostname?: string\n) {\n  return await constructUrlWithExtensionAsync(projectRoot, entryPoint, 'assets', requestHostname);\n}\n\nexport async function constructDebuggerHostAsync(projectRoot: string, requestHostname?: string) {\n  return constructUrlAsync(\n    projectRoot,\n    {\n      urlType: 'no-protocol',\n    },\n    true,\n    requestHostname\n  );\n}\n\nexport async function constructBundleQueryParamsAsync(projectRoot: string, opts: any) {\n  let queryParams = `dev=${encodeURIComponent(!!opts.dev)}`;\n\n  if (opts.hasOwnProperty('strict')) {\n    queryParams += `&strict=${encodeURIComponent(!!opts.strict)}`;\n  }\n\n  if (opts.hasOwnProperty('minify')) {\n    queryParams += `&minify=${encodeURIComponent(!!opts.minify)}`;\n  }\n\n  queryParams += '&hot=false';\n\n  const { exp } = getConfig(projectRoot);\n\n  // SDK11 to SDK32 require us to inject hashAssetFiles through the params, but this is not\n  // needed with SDK33+\n  const supportsAssetPlugins = Versions.gteSdkVersion(exp, '11.0.0');\n  const usesAssetPluginsQueryParam = supportsAssetPlugins && Versions.lteSdkVersion(exp, '32.0.0');\n  if (usesAssetPluginsQueryParam) {\n    // Use an absolute path here so that we can not worry about symlinks/relative requires\n    const pluginModule = resolveModule('expo/tools/hashAssetFiles', projectRoot, exp);\n    queryParams += `&assetPlugin=${encodeURIComponent(pluginModule)}`;\n  } else if (!supportsAssetPlugins) {\n    // Only sdk-10.1.0+ supports the assetPlugin parameter. We use only the\n    // major version in the sdkVersion field, so check for 11.0.0 to be sure.\n    queryParams += '&includeAssetFileHashes=true';\n  }\n\n  return queryParams;\n}\n\nexport async function constructWebAppUrlAsync(\n  projectRoot: string,\n  options: { hostType?: 'localhost' | 'lan' | 'tunnel' } = {}\n): Promise<string | null> {\n  const packagerInfo = await ProjectSettings.readPackagerInfoAsync(projectRoot);\n  if (!packagerInfo.webpackServerPort) {\n    return null;\n  }\n\n  const { https, hostType } = await ProjectSettings.readAsync(projectRoot);\n  const host = (options.hostType ?? hostType) === 'localhost' ? 'localhost' : ip.address();\n\n  let urlType = 'http';\n  if (https === true) {\n    urlType = 'https';\n  }\n\n  return `${urlType}://${host}:${packagerInfo.webpackServerPort}`;\n}\n\nexport async function constructUrlAsync(\n  projectRoot: string,\n  opts: any,\n  isPackager: boolean,\n  requestHostname?: string\n): Promise<string> {\n  if (opts) {\n    const schema = joi.object().keys({\n      urlType: joi.any().valid('exp', 'http', 'redirect', 'no-protocol'),\n      lanType: joi.any().valid('ip', 'hostname'),\n      hostType: joi.any().valid('localhost', 'lan', 'tunnel'),\n      dev: joi.boolean(),\n      strict: joi.boolean(),\n      minify: joi.boolean(),\n      https: joi.boolean().optional(),\n      urlRandomness: joi.string().optional().allow(null),\n    });\n\n    const { error } = schema.validate(opts);\n    if (error) {\n      throw new XDLError('INVALID_OPTIONS', error.toString());\n    }\n  }\n\n  const defaultOpts = await ProjectSettings.getPackagerOptsAsync(projectRoot);\n  if (!opts) {\n    opts = defaultOpts;\n  } else {\n    opts = Object.assign({}, defaultOpts, opts);\n  }\n\n  const packagerInfo = await ProjectSettings.readPackagerInfoAsync(projectRoot);\n\n  let protocol;\n  if (opts.urlType === 'http') {\n    protocol = 'http';\n  } else if (opts.urlType === 'no-protocol') {\n    protocol = null;\n  } else {\n    protocol = 'exp';\n\n    const { exp } = getConfig(projectRoot);\n    if (exp.detach) {\n      // Normalize schemes and filter invalid schemes.\n      const schemes = (Array.isArray(exp.scheme) ? exp.scheme : [exp.scheme]).filter(\n        (scheme: any) => typeof scheme === 'string' && !!scheme\n      );\n      // Get the first valid scheme.\n      const firstScheme = schemes[0];\n      if (firstScheme && Versions.gteSdkVersion(exp, '27.0.0')) {\n        protocol = firstScheme;\n      } else if (exp.detach.scheme) {\n        // must keep this fallback in place for older projects\n        // and those detached with an older version of xdl\n        protocol = exp.detach.scheme;\n      }\n    }\n  }\n\n  let hostname;\n  let port;\n\n  const proxyURL = isPackager\n    ? process.env.EXPO_PACKAGER_PROXY_URL\n    : process.env.EXPO_MANIFEST_PROXY_URL;\n  if (proxyURL) {\n    const parsedProxyURL = url.parse(proxyURL);\n    hostname = parsedProxyURL.hostname;\n    port = parsedProxyURL.port;\n    if (parsedProxyURL.protocol === 'https:') {\n      if (protocol === 'http') {\n        protocol = 'https';\n      }\n      if (!port) {\n        port = '443';\n      }\n    }\n  } else if (opts.hostType === 'localhost' || requestHostname === 'localhost') {\n    hostname = '127.0.0.1';\n    port = isPackager ? packagerInfo.packagerPort : packagerInfo.expoServerPort;\n  } else if (opts.hostType === 'lan' || Config.offline) {\n    if (process.env.EXPO_PACKAGER_HOSTNAME) {\n      hostname = process.env.EXPO_PACKAGER_HOSTNAME.trim();\n    } else if (process.env.REACT_NATIVE_PACKAGER_HOSTNAME) {\n      hostname = process.env.REACT_NATIVE_PACKAGER_HOSTNAME.trim();\n    } else if (opts.lanType === 'ip') {\n      if (requestHostname) {\n        hostname = requestHostname;\n      } else {\n        hostname = ip.address();\n      }\n    } else {\n      // Some old versions of OSX work with hostname but not local ip address.\n      hostname = os.hostname();\n    }\n    port = isPackager ? packagerInfo.packagerPort : packagerInfo.expoServerPort;\n  } else {\n    const ngrokUrl = isPackager ? packagerInfo.packagerNgrokUrl : packagerInfo.expoServerNgrokUrl;\n    if (!ngrokUrl || typeof ngrokUrl !== 'string') {\n      // TODO: if you start with --tunnel flag then this warning will always\n      // show up right before the tunnel starts...\n      ProjectUtils.logWarning(\n        projectRoot,\n        'expo',\n        'Tunnel URL not found (it might not be ready yet), falling back to LAN URL.',\n        'tunnel-url-not-found'\n      );\n      return constructUrlAsync(\n        projectRoot,\n        { ...opts, hostType: 'lan' },\n        isPackager,\n        requestHostname\n      );\n    } else {\n      ProjectUtils.clearNotification(projectRoot, 'tunnel-url-not-found');\n      const pnu = url.parse(ngrokUrl);\n      hostname = pnu.hostname;\n      port = pnu.port;\n    }\n  }\n\n  let url_ = '';\n  if (protocol) {\n    url_ += `${protocol}://`;\n  }\n\n  if (!hostname) {\n    throw new Error('Hostname cannot be inferred.');\n  }\n\n  url_ += hostname;\n\n  if (port) {\n    url_ += `:${port}`;\n  } else {\n    // Android HMR breaks without this :|\n    url_ += ':80';\n  }\n\n  if (opts.urlType === 'redirect') {\n    return `https://exp.host/--/to-exp/${encodeURIComponent(url_)}`;\n  }\n\n  return url_;\n}\n\nexport function guessMainModulePath(entryPoint: string): string {\n  return entryPoint.replace(/\\.js$/, '');\n}\n\nexport function randomIdentifier(length: number = 6): string {\n  const alphabet = '23456789qwertyuipasdfghjkzxcvbnm';\n  let result = '';\n  for (let i = 0; i < length; i++) {\n    const j = Math.floor(Math.random() * alphabet.length);\n    const c = alphabet.substr(j, 1);\n    result += c;\n  }\n  return result;\n}\n\nexport function sevenDigitIdentifier(): string {\n  return `${randomIdentifier(3)}-${randomIdentifier(4)}`;\n}\n\nexport function randomIdentifierForUser(username: string): string {\n  return `${username}-${randomIdentifier(3)}-${randomIdentifier(2)}`;\n}\n\nexport function someRandomness(): string {\n  return [randomIdentifier(2), randomIdentifier(3)].join('-');\n}\n\nexport function domainify(s: string): string {\n  return s\n    .toLowerCase()\n    .replace(/[^a-z0-9-]/g, '-')\n    .replace(/^-+/, '')\n    .replace(/-+$/, '');\n}\n\nexport function isHttps(url: string): boolean {\n  return validator.isURL(url, { protocols: ['https'] });\n}\n"],"file":"../UrlUtils.js","sourceRoot":"/@expo/xdl@58.0.16/src"}