{"version":3,"file":"hmacSha256.esm.js","sources":["../src/hmacSha256.ts"],"sourcesContent":["import { getCryptoLib } from './cryptoUtils';\n\nexport interface Hmac {\n  digest(key: Buffer, data: Buffer): Promise<Buffer>;\n}\n\ntype NodeCryptoCreateHmac = typeof import('crypto').createHmac;\n\nexport class NodeCryptoHmacSha256 implements Hmac {\n  createHmac: NodeCryptoCreateHmac;\n\n  constructor(createHmac: NodeCryptoCreateHmac) {\n    this.createHmac = createHmac;\n  }\n\n  async digest(key: Buffer, data: Buffer): Promise<Buffer> {\n    const result = this.createHmac('sha256', key)\n      .update(data)\n      .digest();\n    return Promise.resolve(result);\n  }\n}\n\nexport class WebCryptoHmacSha256 implements Hmac {\n  subtleCrypto: SubtleCrypto;\n\n  constructor(subtleCrypto: SubtleCrypto) {\n    this.subtleCrypto = subtleCrypto;\n  }\n\n  async digest(key: Buffer, data: Buffer): Promise<Buffer> {\n    const cryptoKey = await this.subtleCrypto.importKey(\n      'raw',\n      key,\n      { name: 'HMAC', hash: 'SHA-256' },\n      true,\n      ['sign']\n    );\n    const sig = await this.subtleCrypto.sign(\n      // The `hash` is only specified for non-compliant browsers like Edge.\n      { name: 'HMAC', hash: 'SHA-256' },\n      cryptoKey,\n      data\n    );\n    return Buffer.from(sig);\n  }\n}\n\nexport async function createHmacSha256(): Promise<Hmac> {\n  const cryptoLib = await getCryptoLib();\n  if (cryptoLib.name === 'subtleCrypto') {\n    return new WebCryptoHmacSha256(cryptoLib.lib);\n  } else {\n    return new NodeCryptoHmacSha256(cryptoLib.lib.createHmac);\n  }\n}\n"],"names":["NodeCryptoHmacSha256","createHmac","digest","key","data","result","update","Promise","resolve","WebCryptoHmacSha256","subtleCrypto","importKey","name","hash","cryptoKey","sign","sig","Buffer","from","createHmacSha256","getCryptoLib","cryptoLib","lib"],"mappings":";;;;IAQaA,oBAAb;AAGE,gCAAYC,UAAZ;AACE,SAAKA,UAAL,GAAkBA,UAAlB;AACD;;AALH;;AAAA,SAOQC,MAPR;AAAA,8EAOE,iBAAaC,GAAb,EAA0BC,IAA1B;AAAA;AAAA;AAAA;AAAA;AAAA;AACQC,cAAAA,MADR,GACiB,KAAKJ,UAAL,CAAgB,QAAhB,EAA0BE,GAA1B,EACZG,MADY,CACLF,IADK,EAEZF,MAFY,EADjB;AAAA,+CAISK,OAAO,CAACC,OAAR,CAAgBH,MAAhB,CAJT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAPF;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;IAeaI,mBAAb;AAGE,+BAAYC,YAAZ;AACE,SAAKA,YAAL,GAAoBA,YAApB;AACD;;AALH;;AAAA,UAOQR,MAPR;AAAA,+EAOE,kBAAaC,GAAb,EAA0BC,IAA1B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAC0B,KAAKM,YAAL,CAAkBC,SAAlB,CACtB,KADsB,EAEtBR,GAFsB,EAGtB;AAAES,gBAAAA,IAAI,EAAE,MAAR;AAAgBC,gBAAAA,IAAI,EAAE;AAAtB,eAHsB,EAItB,IAJsB,EAKtB,CAAC,MAAD,CALsB,CAD1B;;AAAA;AACQC,cAAAA,SADR;AAAA;AAAA,qBAQoB,KAAKJ,YAAL,CAAkBK,IAAlB,CAEhB;AAAEH,gBAAAA,IAAI,EAAE,MAAR;AAAgBC,gBAAAA,IAAI,EAAE;AAAtB,eAFgB,EAGhBC,SAHgB,EAIhBV,IAJgB,CARpB;;AAAA;AAQQY,cAAAA,GARR;AAAA,gDAcSC,MAAM,CAACC,IAAP,CAAYF,GAAZ,CAdT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAPF;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;SAyBsBG,gBAAtB;AAAA;AAAA;;;kEAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACmBC,YAAY,EAD/B;;AAAA;AACCC,YAAAA,SADD;;AAAA,kBAEDA,SAAS,CAACT,IAAV,KAAmB,cAFlB;AAAA;AAAA;AAAA;;AAAA,8CAGI,IAAIH,mBAAJ,CAAwBY,SAAS,CAACC,GAAlC,CAHJ;;AAAA;AAAA,8CAKI,IAAItB,oBAAJ,CAAyBqB,SAAS,CAACC,GAAV,CAAcrB,UAAvC,CALJ;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;"}