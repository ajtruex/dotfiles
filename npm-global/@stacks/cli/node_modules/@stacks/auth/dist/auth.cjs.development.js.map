{"version":3,"file":"auth.cjs.development.js","sources":["../src/constants.ts","../src/appConfig.ts","../../../node_modules/regenerator-runtime/runtime.js","../src/dids.ts","../src/messages.ts","../src/provider.ts","../src/verification.ts","../src/sessionData.ts","../src/sessionStore.ts","../src/protocolEchoDetection.ts","../src/userSession.ts","../src/profile.ts"],"sourcesContent":["/**\n * @ignore\n */\nexport const BLOCKSTACK_HANDLER = 'blockstack';\n/**\n * @ignore\n */\nexport const BLOCKSTACK_STORAGE_LABEL = 'blockstack';\n/**\n * This constant is used in the [[redirectToSignInWithAuthRequest]]\n */\nexport const DEFAULT_BLOCKSTACK_HOST = 'https://browser.blockstack.org/auth';\n\n/**\n * Default user profile object\n */\nexport const DEFAULT_PROFILE = {\n  '@type': 'Person',\n  '@context': 'http://schema.org',\n};\n\n/**\n * Non-exhaustive list of common permission scopes.\n */\nexport const enum AuthScope {\n  /**\n   * Read and write data to the user's Gaia hub in an app-specific storage bucket.\n   * This is the default scope.\n   */\n  store_write = 'store_write',\n  /**\n   * Publish data so that other users of the app can discover and interact with the user.\n   * The user's files stored on Gaia hub are made visible to others via the `apps` property in the\n   * userâ€™s `profile.json` file.\n   */\n  publish_data = 'publish_data',\n  /**\n   * Request the user's email if available.\n   */\n  email = 'email',\n}\n\n/**\n * @ignore\n */\nexport const DEFAULT_SCOPE = [AuthScope.store_write];\n\n/**\n * @ignore\n */\nexport const BLOCKSTACK_APP_PRIVATE_KEY_LABEL = 'blockstack-transit-private-key';\n\n/**\n * @ignore\n */\nexport const DEFAULT_CORE_NODE = 'https://core.blockstack.org';\n/**\n * @ignore\n */\nexport const NAME_LOOKUP_PATH = '/v1/names';\n/**\n * @ignore\n */\nexport const LOCALSTORAGE_SESSION_KEY = 'blockstack-session';\n","import { DEFAULT_SCOPE, DEFAULT_BLOCKSTACK_HOST, AuthScope } from './constants';\nimport { getGlobalObject } from '@stacks/common';\n\n/**\n * Configuration data for the current app.\n *\n * On browser platforms, creating an instance of this\n * class without any arguments will use\n * `window.location.origin` as the app domain.\n * On non-browser platforms, you need to\n * specify an app domain as the second argument.\n *\n */\nexport class AppConfig {\n  /**\n   * Blockstack apps are uniquely identified by their app domain.\n   *\n   */\n  appDomain?: string;\n\n  /**\n   * An array of string representing permissions requested by the app.\n   *\n   */\n  scopes: (AuthScope | string)[];\n\n  /**\n   * Path on app domain to redirect users to after authentication. The\n   * authentication response token will be postpended in a query.\n   *\n   */\n  redirectPath: string;\n\n  /**\n   * Path relative to app domain of app's manifest file.\n   *\n   * This file needs to have CORS headers set so that it can be fetched\n   * from any origin. Typically this means return the header `Access-Control-Allow-Origin: *`.\n   *\n   */\n  manifestPath: string;\n\n  /**\n   * The URL of Blockstack core node to use for this app. If this is\n   * `null`, the core node specified by the user or default core node\n   * will be used.\n   *\n   */\n  coreNode?: string;\n\n  /**\n   * The URL of a web-based Blockstack Authenticator to use in the event\n   * the user doesn't have Blockstack installed on their machine. If this\n   * is not specified, the current default in this library will be used.\n   *\n   */\n  authenticatorURL?: string;\n\n  /**\n   * @param {Array<string>} scopes - permissions this app is requesting\n   * @param {string} appDomain - the app domain\n   * @param {string} redirectPath - path on app domain to redirect users to after authentication\n   * @param {string} manifestPath - path relative to app domain of app's manifest file\n   * @param {string | undefined} coreNode - override the default or user selected core node\n   * @param {string} authenticatorURL - the web-based fall back authenticator\n   * ([[DEFAULT_BLOCKSTACK_HOST]])\n   */\n  constructor(\n    scopes: string[] = DEFAULT_SCOPE.slice(),\n    appDomain: string | undefined = getGlobalObject('location', { returnEmptyObject: true })\n      ?.origin,\n    redirectPath = '',\n    manifestPath = '/manifest.json',\n    coreNode: string | undefined = undefined,\n    authenticatorURL: string = DEFAULT_BLOCKSTACK_HOST\n  ) {\n    this.appDomain = appDomain;\n    this.scopes = scopes;\n    this.redirectPath = redirectPath;\n    this.manifestPath = manifestPath;\n    this.coreNode = coreNode;\n    this.authenticatorURL = authenticatorURL;\n  }\n\n  /**\n   * The location to which the authenticator should\n   * redirect the user.\n   * @returns {string} - URI\n   */\n  redirectURI(): string {\n    return `${this.appDomain}${this.redirectPath}`;\n  }\n\n  /**\n   * The location of the app's manifest file.\n   * @returns {string} - URI\n   */\n  manifestURI(): string {\n    return `${this.appDomain}${this.manifestPath}`;\n  }\n}\n","/**\n * Copyright (c) 2014-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nvar runtime = (function (exports) {\n  \"use strict\";\n\n  var Op = Object.prototype;\n  var hasOwn = Op.hasOwnProperty;\n  var undefined; // More compressible than void 0.\n  var $Symbol = typeof Symbol === \"function\" ? Symbol : {};\n  var iteratorSymbol = $Symbol.iterator || \"@@iterator\";\n  var asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\";\n  var toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n\n  function define(obj, key, value) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n    return obj[key];\n  }\n  try {\n    // IE 8 has a broken Object.defineProperty that only works on DOM objects.\n    define({}, \"\");\n  } catch (err) {\n    define = function(obj, key, value) {\n      return obj[key] = value;\n    };\n  }\n\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;\n    var generator = Object.create(protoGenerator.prototype);\n    var context = new Context(tryLocsList || []);\n\n    // The ._invoke method unifies the implementations of the .next,\n    // .throw, and .return methods.\n    generator._invoke = makeInvokeMethod(innerFn, self, context);\n\n    return generator;\n  }\n  exports.wrap = wrap;\n\n  // Try/catch helper to minimize deoptimizations. Returns a completion\n  // record like context.tryEntries[i].completion. This interface could\n  // have been (and was previously) designed to take a closure to be\n  // invoked without arguments, but in all the cases we care about we\n  // already have an existing method we want to call, so there's no need\n  // to create a new function object. We can even get away with assuming\n  // the method takes exactly one argument, since that happens to be true\n  // in every case, so we don't have to touch the arguments object. The\n  // only additional allocation required is the completion record, which\n  // has a stable shape and so hopefully should be cheap to allocate.\n  function tryCatch(fn, obj, arg) {\n    try {\n      return { type: \"normal\", arg: fn.call(obj, arg) };\n    } catch (err) {\n      return { type: \"throw\", arg: err };\n    }\n  }\n\n  var GenStateSuspendedStart = \"suspendedStart\";\n  var GenStateSuspendedYield = \"suspendedYield\";\n  var GenStateExecuting = \"executing\";\n  var GenStateCompleted = \"completed\";\n\n  // Returning this object from the innerFn has the same effect as\n  // breaking out of the dispatch switch statement.\n  var ContinueSentinel = {};\n\n  // Dummy constructor functions that we use as the .constructor and\n  // .constructor.prototype properties for functions that return Generator\n  // objects. For full spec compliance, you may wish to configure your\n  // minifier not to mangle the names of these two functions.\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n\n  // This is a polyfill for %IteratorPrototype% for environments that\n  // don't natively support it.\n  var IteratorPrototype = {};\n  IteratorPrototype[iteratorSymbol] = function () {\n    return this;\n  };\n\n  var getProto = Object.getPrototypeOf;\n  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));\n  if (NativeIteratorPrototype &&\n      NativeIteratorPrototype !== Op &&\n      hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {\n    // This environment has a native %IteratorPrototype%; use it instead\n    // of the polyfill.\n    IteratorPrototype = NativeIteratorPrototype;\n  }\n\n  var Gp = GeneratorFunctionPrototype.prototype =\n    Generator.prototype = Object.create(IteratorPrototype);\n  GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;\n  GeneratorFunctionPrototype.constructor = GeneratorFunction;\n  GeneratorFunction.displayName = define(\n    GeneratorFunctionPrototype,\n    toStringTagSymbol,\n    \"GeneratorFunction\"\n  );\n\n  // Helper for defining the .next, .throw, and .return methods of the\n  // Iterator interface in terms of a single ._invoke method.\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function(method) {\n      define(prototype, method, function(arg) {\n        return this._invoke(method, arg);\n      });\n    });\n  }\n\n  exports.isGeneratorFunction = function(genFun) {\n    var ctor = typeof genFun === \"function\" && genFun.constructor;\n    return ctor\n      ? ctor === GeneratorFunction ||\n        // For the native GeneratorFunction constructor, the best we can\n        // do is to check its .name property.\n        (ctor.displayName || ctor.name) === \"GeneratorFunction\"\n      : false;\n  };\n\n  exports.mark = function(genFun) {\n    if (Object.setPrototypeOf) {\n      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);\n    } else {\n      genFun.__proto__ = GeneratorFunctionPrototype;\n      define(genFun, toStringTagSymbol, \"GeneratorFunction\");\n    }\n    genFun.prototype = Object.create(Gp);\n    return genFun;\n  };\n\n  // Within the body of any async function, `await x` is transformed to\n  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test\n  // `hasOwn.call(value, \"__await\")` to determine if the yielded value is\n  // meant to be awaited.\n  exports.awrap = function(arg) {\n    return { __await: arg };\n  };\n\n  function AsyncIterator(generator, PromiseImpl) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n      if (record.type === \"throw\") {\n        reject(record.arg);\n      } else {\n        var result = record.arg;\n        var value = result.value;\n        if (value &&\n            typeof value === \"object\" &&\n            hasOwn.call(value, \"__await\")) {\n          return PromiseImpl.resolve(value.__await).then(function(value) {\n            invoke(\"next\", value, resolve, reject);\n          }, function(err) {\n            invoke(\"throw\", err, resolve, reject);\n          });\n        }\n\n        return PromiseImpl.resolve(value).then(function(unwrapped) {\n          // When a yielded Promise is resolved, its final value becomes\n          // the .value of the Promise<{value,done}> result for the\n          // current iteration.\n          result.value = unwrapped;\n          resolve(result);\n        }, function(error) {\n          // If a rejected Promise was yielded, throw the rejection back\n          // into the async generator function so it can be handled there.\n          return invoke(\"throw\", error, resolve, reject);\n        });\n      }\n    }\n\n    var previousPromise;\n\n    function enqueue(method, arg) {\n      function callInvokeWithMethodAndArg() {\n        return new PromiseImpl(function(resolve, reject) {\n          invoke(method, arg, resolve, reject);\n        });\n      }\n\n      return previousPromise =\n        // If enqueue has been called before, then we want to wait until\n        // all previous Promises have been resolved before calling invoke,\n        // so that results are always delivered in the correct order. If\n        // enqueue has not been called before, then it is important to\n        // call invoke immediately, without waiting on a callback to fire,\n        // so that the async generator function has the opportunity to do\n        // any necessary setup in a predictable way. This predictability\n        // is why the Promise constructor synchronously invokes its\n        // executor callback, and why async functions synchronously\n        // execute code before the first await. Since we implement simple\n        // async functions in terms of async generators, it is especially\n        // important to get this right, even though it requires care.\n        previousPromise ? previousPromise.then(\n          callInvokeWithMethodAndArg,\n          // Avoid propagating failures to Promises returned by later\n          // invocations of the iterator.\n          callInvokeWithMethodAndArg\n        ) : callInvokeWithMethodAndArg();\n    }\n\n    // Define the unified helper method that is used to implement .next,\n    // .throw, and .return (see defineIteratorMethods).\n    this._invoke = enqueue;\n  }\n\n  defineIteratorMethods(AsyncIterator.prototype);\n  AsyncIterator.prototype[asyncIteratorSymbol] = function () {\n    return this;\n  };\n  exports.AsyncIterator = AsyncIterator;\n\n  // Note that simple async functions are implemented on top of\n  // AsyncIterator objects; they just return a Promise for the value of\n  // the final result produced by the iterator.\n  exports.async = function(innerFn, outerFn, self, tryLocsList, PromiseImpl) {\n    if (PromiseImpl === void 0) PromiseImpl = Promise;\n\n    var iter = new AsyncIterator(\n      wrap(innerFn, outerFn, self, tryLocsList),\n      PromiseImpl\n    );\n\n    return exports.isGeneratorFunction(outerFn)\n      ? iter // If outerFn is a generator, return the full iterator.\n      : iter.next().then(function(result) {\n          return result.done ? result.value : iter.next();\n        });\n  };\n\n  function makeInvokeMethod(innerFn, self, context) {\n    var state = GenStateSuspendedStart;\n\n    return function invoke(method, arg) {\n      if (state === GenStateExecuting) {\n        throw new Error(\"Generator is already running\");\n      }\n\n      if (state === GenStateCompleted) {\n        if (method === \"throw\") {\n          throw arg;\n        }\n\n        // Be forgiving, per 25.3.3.3.3 of the spec:\n        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume\n        return doneResult();\n      }\n\n      context.method = method;\n      context.arg = arg;\n\n      while (true) {\n        var delegate = context.delegate;\n        if (delegate) {\n          var delegateResult = maybeInvokeDelegate(delegate, context);\n          if (delegateResult) {\n            if (delegateResult === ContinueSentinel) continue;\n            return delegateResult;\n          }\n        }\n\n        if (context.method === \"next\") {\n          // Setting context._sent for legacy support of Babel's\n          // function.sent implementation.\n          context.sent = context._sent = context.arg;\n\n        } else if (context.method === \"throw\") {\n          if (state === GenStateSuspendedStart) {\n            state = GenStateCompleted;\n            throw context.arg;\n          }\n\n          context.dispatchException(context.arg);\n\n        } else if (context.method === \"return\") {\n          context.abrupt(\"return\", context.arg);\n        }\n\n        state = GenStateExecuting;\n\n        var record = tryCatch(innerFn, self, context);\n        if (record.type === \"normal\") {\n          // If an exception is thrown from innerFn, we leave state ===\n          // GenStateExecuting and loop back for another invocation.\n          state = context.done\n            ? GenStateCompleted\n            : GenStateSuspendedYield;\n\n          if (record.arg === ContinueSentinel) {\n            continue;\n          }\n\n          return {\n            value: record.arg,\n            done: context.done\n          };\n\n        } else if (record.type === \"throw\") {\n          state = GenStateCompleted;\n          // Dispatch the exception by looping back around to the\n          // context.dispatchException(context.arg) call above.\n          context.method = \"throw\";\n          context.arg = record.arg;\n        }\n      }\n    };\n  }\n\n  // Call delegate.iterator[context.method](context.arg) and handle the\n  // result, either by returning a { value, done } result from the\n  // delegate iterator, or by modifying context.method and context.arg,\n  // setting context.delegate to null, and returning the ContinueSentinel.\n  function maybeInvokeDelegate(delegate, context) {\n    var method = delegate.iterator[context.method];\n    if (method === undefined) {\n      // A .throw or .return when the delegate iterator has no .throw\n      // method always terminates the yield* loop.\n      context.delegate = null;\n\n      if (context.method === \"throw\") {\n        // Note: [\"return\"] must be used for ES3 parsing compatibility.\n        if (delegate.iterator[\"return\"]) {\n          // If the delegate iterator has a return method, give it a\n          // chance to clean up.\n          context.method = \"return\";\n          context.arg = undefined;\n          maybeInvokeDelegate(delegate, context);\n\n          if (context.method === \"throw\") {\n            // If maybeInvokeDelegate(context) changed context.method from\n            // \"return\" to \"throw\", let that override the TypeError below.\n            return ContinueSentinel;\n          }\n        }\n\n        context.method = \"throw\";\n        context.arg = new TypeError(\n          \"The iterator does not provide a 'throw' method\");\n      }\n\n      return ContinueSentinel;\n    }\n\n    var record = tryCatch(method, delegate.iterator, context.arg);\n\n    if (record.type === \"throw\") {\n      context.method = \"throw\";\n      context.arg = record.arg;\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    var info = record.arg;\n\n    if (! info) {\n      context.method = \"throw\";\n      context.arg = new TypeError(\"iterator result is not an object\");\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    if (info.done) {\n      // Assign the result of the finished delegate to the temporary\n      // variable specified by delegate.resultName (see delegateYield).\n      context[delegate.resultName] = info.value;\n\n      // Resume execution at the desired location (see delegateYield).\n      context.next = delegate.nextLoc;\n\n      // If context.method was \"throw\" but the delegate handled the\n      // exception, let the outer generator proceed normally. If\n      // context.method was \"next\", forget context.arg since it has been\n      // \"consumed\" by the delegate iterator. If context.method was\n      // \"return\", allow the original .return call to continue in the\n      // outer generator.\n      if (context.method !== \"return\") {\n        context.method = \"next\";\n        context.arg = undefined;\n      }\n\n    } else {\n      // Re-yield the result returned by the delegate method.\n      return info;\n    }\n\n    // The delegate iterator is finished, so forget it and continue with\n    // the outer generator.\n    context.delegate = null;\n    return ContinueSentinel;\n  }\n\n  // Define Generator.prototype.{next,throw,return} in terms of the\n  // unified ._invoke helper method.\n  defineIteratorMethods(Gp);\n\n  define(Gp, toStringTagSymbol, \"Generator\");\n\n  // A Generator should always return itself as the iterator object when the\n  // @@iterator function is called on it. Some browsers' implementations of the\n  // iterator prototype chain incorrectly implement this, causing the Generator\n  // object to not be returned from this call. This ensures that doesn't happen.\n  // See https://github.com/facebook/regenerator/issues/274 for more details.\n  Gp[iteratorSymbol] = function() {\n    return this;\n  };\n\n  Gp.toString = function() {\n    return \"[object Generator]\";\n  };\n\n  function pushTryEntry(locs) {\n    var entry = { tryLoc: locs[0] };\n\n    if (1 in locs) {\n      entry.catchLoc = locs[1];\n    }\n\n    if (2 in locs) {\n      entry.finallyLoc = locs[2];\n      entry.afterLoc = locs[3];\n    }\n\n    this.tryEntries.push(entry);\n  }\n\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\";\n    delete record.arg;\n    entry.completion = record;\n  }\n\n  function Context(tryLocsList) {\n    // The root entry object (effectively a try statement without a catch\n    // or a finally block) gives us a place to store values thrown from\n    // locations where there is no enclosing try statement.\n    this.tryEntries = [{ tryLoc: \"root\" }];\n    tryLocsList.forEach(pushTryEntry, this);\n    this.reset(true);\n  }\n\n  exports.keys = function(object) {\n    var keys = [];\n    for (var key in object) {\n      keys.push(key);\n    }\n    keys.reverse();\n\n    // Rather than returning an object with a next method, we keep\n    // things simple and return the next function itself.\n    return function next() {\n      while (keys.length) {\n        var key = keys.pop();\n        if (key in object) {\n          next.value = key;\n          next.done = false;\n          return next;\n        }\n      }\n\n      // To avoid creating an additional object, we just hang the .value\n      // and .done properties off the next function object itself. This\n      // also ensures that the minifier will not anonymize the function.\n      next.done = true;\n      return next;\n    };\n  };\n\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) {\n        return iteratorMethod.call(iterable);\n      }\n\n      if (typeof iterable.next === \"function\") {\n        return iterable;\n      }\n\n      if (!isNaN(iterable.length)) {\n        var i = -1, next = function next() {\n          while (++i < iterable.length) {\n            if (hasOwn.call(iterable, i)) {\n              next.value = iterable[i];\n              next.done = false;\n              return next;\n            }\n          }\n\n          next.value = undefined;\n          next.done = true;\n\n          return next;\n        };\n\n        return next.next = next;\n      }\n    }\n\n    // Return an iterator with no values.\n    return { next: doneResult };\n  }\n  exports.values = values;\n\n  function doneResult() {\n    return { value: undefined, done: true };\n  }\n\n  Context.prototype = {\n    constructor: Context,\n\n    reset: function(skipTempReset) {\n      this.prev = 0;\n      this.next = 0;\n      // Resetting context._sent for legacy support of Babel's\n      // function.sent implementation.\n      this.sent = this._sent = undefined;\n      this.done = false;\n      this.delegate = null;\n\n      this.method = \"next\";\n      this.arg = undefined;\n\n      this.tryEntries.forEach(resetTryEntry);\n\n      if (!skipTempReset) {\n        for (var name in this) {\n          // Not sure about the optimal order of these conditions:\n          if (name.charAt(0) === \"t\" &&\n              hasOwn.call(this, name) &&\n              !isNaN(+name.slice(1))) {\n            this[name] = undefined;\n          }\n        }\n      }\n    },\n\n    stop: function() {\n      this.done = true;\n\n      var rootEntry = this.tryEntries[0];\n      var rootRecord = rootEntry.completion;\n      if (rootRecord.type === \"throw\") {\n        throw rootRecord.arg;\n      }\n\n      return this.rval;\n    },\n\n    dispatchException: function(exception) {\n      if (this.done) {\n        throw exception;\n      }\n\n      var context = this;\n      function handle(loc, caught) {\n        record.type = \"throw\";\n        record.arg = exception;\n        context.next = loc;\n\n        if (caught) {\n          // If the dispatched exception was caught by a catch block,\n          // then let that catch block handle the exception normally.\n          context.method = \"next\";\n          context.arg = undefined;\n        }\n\n        return !! caught;\n      }\n\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        var record = entry.completion;\n\n        if (entry.tryLoc === \"root\") {\n          // Exception thrown outside of any try block that could handle\n          // it, so set the completion value of the entire function to\n          // throw the exception.\n          return handle(\"end\");\n        }\n\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\");\n          var hasFinally = hasOwn.call(entry, \"finallyLoc\");\n\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            } else if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            }\n\n          } else if (hasFinally) {\n            if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else {\n            throw new Error(\"try statement without catch or finally\");\n          }\n        }\n      }\n    },\n\n    abrupt: function(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc <= this.prev &&\n            hasOwn.call(entry, \"finallyLoc\") &&\n            this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n\n      if (finallyEntry &&\n          (type === \"break\" ||\n           type === \"continue\") &&\n          finallyEntry.tryLoc <= arg &&\n          arg <= finallyEntry.finallyLoc) {\n        // Ignore the finally entry if control is not jumping to a\n        // location outside the try/catch block.\n        finallyEntry = null;\n      }\n\n      var record = finallyEntry ? finallyEntry.completion : {};\n      record.type = type;\n      record.arg = arg;\n\n      if (finallyEntry) {\n        this.method = \"next\";\n        this.next = finallyEntry.finallyLoc;\n        return ContinueSentinel;\n      }\n\n      return this.complete(record);\n    },\n\n    complete: function(record, afterLoc) {\n      if (record.type === \"throw\") {\n        throw record.arg;\n      }\n\n      if (record.type === \"break\" ||\n          record.type === \"continue\") {\n        this.next = record.arg;\n      } else if (record.type === \"return\") {\n        this.rval = this.arg = record.arg;\n        this.method = \"return\";\n        this.next = \"end\";\n      } else if (record.type === \"normal\" && afterLoc) {\n        this.next = afterLoc;\n      }\n\n      return ContinueSentinel;\n    },\n\n    finish: function(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) {\n          this.complete(entry.completion, entry.afterLoc);\n          resetTryEntry(entry);\n          return ContinueSentinel;\n        }\n      }\n    },\n\n    \"catch\": function(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n          if (record.type === \"throw\") {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n          return thrown;\n        }\n      }\n\n      // The context.catch method must only be called with a location\n      // argument that corresponds to a known catch block.\n      throw new Error(\"illegal catch attempt\");\n    },\n\n    delegateYield: function(iterable, resultName, nextLoc) {\n      this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      };\n\n      if (this.method === \"next\") {\n        // Deliberately forget the last sent value so that we don't\n        // accidentally pass it on to the delegate.\n        this.arg = undefined;\n      }\n\n      return ContinueSentinel;\n    }\n  };\n\n  // Regardless of whether this script is executing as a CommonJS module\n  // or not, return the runtime object so that we can declare the variable\n  // regeneratorRuntime in the outer scope, which allows this module to be\n  // injected easily by `bin/regenerator --include-runtime script.js`.\n  return exports;\n\n}(\n  // If this script is executing as a CommonJS module, use module.exports\n  // as the regeneratorRuntime namespace. Otherwise create a new empty\n  // object. Either way, the resulting object will be used to initialize\n  // the regeneratorRuntime variable at the top of this file.\n  typeof module === \"object\" ? module.exports : {}\n));\n\ntry {\n  regeneratorRuntime = runtime;\n} catch (accidentalStrictMode) {\n  // This module should not be running in strict mode, so the above\n  // assignment should always work unless something is misconfigured. Just\n  // in case runtime.js accidentally runs in strict mode, we can escape\n  // strict mode using a global Function call. This could conceivably fail\n  // if a Content Security Policy forbids using Function, but in that case\n  // the proper solution is to fix the accidental strict mode problem. If\n  // you've misconfigured your bundler to force strict mode and applied a\n  // CSP to forbid Function, and you're not willing to fix either of those\n  // problems, please detail your unique predicament in a GitHub issue.\n  Function(\"r\", \"regeneratorRuntime = r\")(runtime);\n}\n","import { InvalidDIDError } from '@stacks/common';\n\n/**\n * @ignore\n */\nexport function makeDIDFromAddress(address: string) {\n  return `did:btc-addr:${address}`;\n}\n\n/**\n * @ignore\n */\nexport function makeDIDFromPublicKey(publicKey: string) {\n  return `did:ecdsa-pub:${publicKey}`;\n}\n\n/**\n * @ignore\n */\nexport function getDIDType(decentralizedID: string) {\n  const didParts = decentralizedID.split(':');\n\n  if (didParts.length !== 3) {\n    throw new InvalidDIDError('Decentralized IDs must have 3 parts');\n  }\n\n  if (didParts[0].toLowerCase() !== 'did') {\n    throw new InvalidDIDError('Decentralized IDs must start with \"did\"');\n  }\n\n  return didParts[1].toLowerCase();\n}\n\n/**\n * @ignore\n */\nexport function getAddressFromDID(decentralizedID?: string): string | undefined {\n  if (decentralizedID) {\n    const didType = getDIDType(decentralizedID);\n    if (didType === 'btc-addr') {\n      return decentralizedID.split(':')[2];\n    } else {\n      return undefined;\n    }\n  }\n  return undefined;\n}\n\n/*\nexport function getPublicKeyOrAddressFromDID(decentralizedID) {\n  const didParts = decentralizedID.split(':')\n\n  if (didParts.length !== 3) {\n    throw new InvalidDIDError('Decentralized IDs must have 3 parts')\n  }\n\n  if (didParts[0].toLowerCase() !== 'did') {\n    throw new InvalidDIDError('Decentralized IDs must start with \"did\"')\n  }\n\n  if (didParts[1].toLowerCase() === 'ecdsa-pub') {\n    return didParts[2]\n  } else if (didParts[1].toLowerCase() === 'btc-addr') {\n    return didParts[2]\n  } else {\n    throw new InvalidDIDError('Decentralized ID format not supported')\n  }\n}\n*/\n","// eslint-disable-next-line import/no-unassigned-import\nimport 'cross-fetch/polyfill';\n\nimport { TokenSigner, SECP256K1Client } from 'jsontokens';\nimport { makeUUID4, nextMonth, getGlobalObject } from '@stacks/common';\nimport { makeDIDFromAddress } from './dids';\nimport {\n  encryptECIES,\n  decryptECIES,\n  makeECPrivateKey,\n  publicKeyToAddress,\n} from '@stacks/encryption';\nimport { DEFAULT_SCOPE, AuthScope } from './constants';\n\nconst VERSION = '1.3.1';\n\ntype AuthMetadata = {\n  email?: string;\n  profileUrl?: string;\n};\n\n/**\n * Generates a ECDSA keypair to\n * use as the ephemeral app transit private key\n * @param {SessionData} session - session object in which key will be stored\n * @return {String} the hex encoded private key\n * @private\n * @ignore\n */\nexport function generateTransitKey() {\n  const transitKey = makeECPrivateKey();\n  return transitKey;\n}\n\n/**\n * Generates an authentication request that can be sent to the Blockstack\n * browser for the user to approve sign in. This authentication request can\n * then be used for sign in by passing it to the `redirectToSignInWithAuthRequest`\n * method.\n *\n * *Note: This method should only be used if you want to roll your own authentication\n * flow. Typically you'd use `redirectToSignIn` which takes care of this\n * under the hood.*\n *\n * @param  {String} transitPrivateKey - hex encoded transit private key\n * @param {String} redirectURI - location to redirect user to after sign in approval\n * @param {String} manifestURI - location of this app's manifest file\n * @param {(AuthScope | string)[]} scopes - the permissions this app is requesting\n * @param {String} appDomain - the origin of this app\n * @param {Number} expiresAt - the time at which this request is no longer valid\n * @param {Object} extraParams - Any extra parameters you'd like to pass to the authenticator.\n * Use this to pass options that aren't part of the Blockstack auth spec, but might be supported\n * by special authenticators.\n * @return {String} the authentication request\n */\nexport function makeAuthRequest(\n  transitPrivateKey: string,\n  redirectURI?: string,\n  manifestURI?: string,\n  scopes: (AuthScope | string)[] = DEFAULT_SCOPE.slice(),\n  appDomain?: string,\n  expiresAt: number = nextMonth().getTime(),\n  extraParams: any = {}\n): string {\n  const getWindowOrigin = (paramName: string) => {\n    const location = getGlobalObject('location', {\n      throwIfUnavailable: true,\n      usageDesc: `makeAuthRequest([${paramName}=undefined])`,\n    });\n    return location?.origin;\n  };\n\n  if (!redirectURI) {\n    redirectURI = `${getWindowOrigin('redirectURI')}/`;\n  }\n  if (!manifestURI) {\n    manifestURI = `${getWindowOrigin('manifestURI')}/manifest.json`;\n  }\n  if (!appDomain) {\n    appDomain = getWindowOrigin('appDomain');\n  }\n\n  /* Create the payload */\n  const payload = Object.assign({}, extraParams, {\n    jti: makeUUID4(),\n    iat: Math.floor(new Date().getTime() / 1000), // JWT times are in seconds\n    exp: Math.floor(expiresAt / 1000), // JWT times are in seconds\n    iss: null,\n    public_keys: [],\n    domain_name: appDomain,\n    manifest_uri: manifestURI,\n    redirect_uri: redirectURI,\n    version: VERSION,\n    do_not_include_profile: true,\n    supports_hub_url: true,\n    scopes,\n  });\n\n  // Logger.info(`blockstack.js: generating v${VERSION} auth request`)\n\n  /* Convert the private key to a public key to an issuer */\n  const publicKey = SECP256K1Client.derivePublicKey(transitPrivateKey);\n  payload.public_keys = [publicKey];\n  const address = publicKeyToAddress(publicKey);\n  payload.iss = makeDIDFromAddress(address);\n\n  /* Sign and return the token */\n  const tokenSigner = new TokenSigner('ES256k', transitPrivateKey);\n  const token = tokenSigner.sign(payload);\n\n  return token;\n}\n\n/**\n * Encrypts the private key for decryption by the given\n * public key.\n * @param  {String} publicKey  [description]\n * @param  {String} privateKey [description]\n * @return {String} hex encoded ciphertext\n * @private\n * @ignore\n */\nexport async function encryptPrivateKey(publicKey: string, privateKey: string): Promise<string> {\n  const encryptedObj = await encryptECIES(publicKey, Buffer.from(privateKey), true);\n  const encryptedJSON = JSON.stringify(encryptedObj);\n  return Buffer.from(encryptedJSON).toString('hex');\n}\n\n/**\n * Decrypts the hex encrypted private key\n * @param  {String} privateKey  the private key corresponding to the public\n * key for which the ciphertext was encrypted\n * @param  {String} hexedEncrypted the ciphertext\n * @return {String}  the decrypted private key\n * @throws {Error} if unable to decrypt\n *\n * @private\n * @ignore\n */\nexport async function decryptPrivateKey(\n  privateKey: string,\n  hexedEncrypted: string\n): Promise<string | null> {\n  const unhexedString = Buffer.from(hexedEncrypted, 'hex').toString();\n  const encryptedObj = JSON.parse(unhexedString);\n  const decrypted = await decryptECIES(privateKey, encryptedObj);\n  if (typeof decrypted !== 'string') {\n    throw new Error('Unable to correctly decrypt private key');\n  } else {\n    return decrypted;\n  }\n}\n\n/**\n * Generates a signed authentication response token for an app. This\n * token is sent back to apps which use contents to access the\n * resources and data requested by the app.\n *\n * @param  {String} privateKey the identity key of the Blockstack ID generating\n * the authentication response\n * @param  {Object} profile the profile object for the Blockstack ID\n * @param  {String} username the username of the Blockstack ID if any, otherwise `null`\n * @param  {AuthMetadata} metadata an object containing metadata sent as part of the authentication\n * response including `email` if requested and available and a URL to the profile\n * @param  {String} coreToken core session token when responding to a legacy auth request\n * or `null` for current direct to gaia authentication requests\n * @param  {String} appPrivateKey the application private key. This private key is\n * unique and specific for every Blockstack ID and application combination.\n * @param  {Number} expiresAt an integer in the same format as\n * `new Date().getTime()`, milliseconds since the Unix epoch\n * @param {String} transitPublicKey the public key provide by the app\n * in its authentication request with which secrets will be encrypted\n * @param {String} hubUrl URL to the write path of the user's Gaia hub\n * @param {String} blockstackAPIUrl URL to the API endpoint to use\n * @param {String} associationToken JWT that binds the app key to the identity key\n * @return {String} signed and encoded authentication response token\n * @private\n * @ignore\n */\nexport async function makeAuthResponse(\n  privateKey: string,\n  profile: {} = {},\n  username: string | null = null,\n  metadata: AuthMetadata | null,\n  coreToken: string | null = null,\n  appPrivateKey: string | null = null,\n  expiresAt: number = nextMonth().getTime(),\n  transitPublicKey: string | null = null,\n  hubUrl: string | null = null,\n  blockstackAPIUrl: string | null = null,\n  associationToken: string | null = null\n): Promise<string> {\n  /* Convert the private key to a public key to an issuer */\n  const publicKey = SECP256K1Client.derivePublicKey(privateKey);\n  const address = publicKeyToAddress(publicKey);\n\n  /* See if we should encrypt with the transit key */\n  let privateKeyPayload = appPrivateKey;\n  let coreTokenPayload = coreToken;\n  let additionalProperties = {};\n  if (appPrivateKey !== undefined && appPrivateKey !== null) {\n    // Logger.info(`blockstack.js: generating v${VERSION} auth response`)\n    if (transitPublicKey !== undefined && transitPublicKey !== null) {\n      privateKeyPayload = await encryptPrivateKey(transitPublicKey, appPrivateKey);\n      if (coreToken !== undefined && coreToken !== null) {\n        coreTokenPayload = await encryptPrivateKey(transitPublicKey, coreToken);\n      }\n    }\n    additionalProperties = {\n      email: metadata?.email ? metadata.email : null,\n      profile_url: metadata?.profileUrl ? metadata.profileUrl : null,\n      hubUrl,\n      blockstackAPIUrl,\n      associationToken,\n      version: VERSION,\n    };\n  } else {\n    // Logger.info('blockstack.js: generating legacy auth response')\n  }\n\n  /* Create the payload */\n  const payload = Object.assign(\n    {},\n    {\n      jti: makeUUID4(),\n      iat: Math.floor(new Date().getTime() / 1000), // JWT times are in seconds\n      exp: Math.floor(expiresAt / 1000), // JWT times are in seconds\n      iss: makeDIDFromAddress(address),\n      private_key: privateKeyPayload,\n      public_keys: [publicKey],\n      profile,\n      username,\n      core_token: coreTokenPayload,\n    },\n    additionalProperties\n  );\n\n  /* Sign and return the token */\n  const tokenSigner = new TokenSigner('ES256k', privateKey);\n  return tokenSigner.sign(payload);\n}\n","import * as queryString from 'query-string';\nimport { decodeToken } from 'jsontokens';\nimport { BLOCKSTACK_HANDLER, getGlobalObject, fetchPrivate } from '@stacks/common';\n\n/**\n * Retrieves the authentication request from the query string\n * @return {String|null} the authentication request or `null` if\n * the query string parameter `authRequest` is not found\n * @private\n * @ignore\n */\nexport function getAuthRequestFromURL() {\n  const location = getGlobalObject('location', {\n    throwIfUnavailable: true,\n    usageDesc: 'getAuthRequestFromURL',\n  });\n  if (location?.search) {\n    const queryDict = queryString.parse(location?.search);\n    if (queryDict.authRequest) {\n      return (queryDict.authRequest as string).split(`${BLOCKSTACK_HANDLER}:`).join('');\n    } else {\n      return null;\n    }\n  } else {\n    return null;\n  }\n}\n\n/**\n * Fetches the contents of the manifest file specified in the authentication request\n *\n * @param  {String} authRequest encoded and signed authentication request\n * @return {Promise<Object|String>} Returns a `Promise` that resolves to the JSON\n * object manifest file unless there's an error in which case rejects with an error\n * message.\n * @private\n * @ignore\n */\nexport async function fetchAppManifest(authRequest: string): Promise<any> {\n  if (!authRequest) {\n    throw new Error('Invalid auth request');\n  }\n  const payload = decodeToken(authRequest).payload;\n  if (typeof payload === 'string') {\n    throw new Error('Unexpected token payload type of string');\n  }\n  const manifestURI = payload.manifest_uri as string;\n  try {\n    // Logger.debug(`Fetching manifest from ${manifestURI}`)\n    const response = await fetchPrivate(manifestURI);\n    const responseText = await response.text();\n    const responseJSON = JSON.parse(responseText);\n    return { ...responseJSON, manifestURI };\n  } catch (error) {\n    console.log(error);\n    throw new Error('Could not fetch manifest.json');\n  }\n}\n","import { decodeToken, TokenVerifier } from 'jsontokens';\nimport { getAddressFromDID } from './dids';\nimport { publicKeyToAddress } from '@stacks/encryption';\nimport { fetchPrivate, isSameOriginAbsoluteUrl } from '@stacks/common';\nimport { fetchAppManifest } from './provider';\n\n/**\n * Checks if the ES256k signature on passed `token` match the claimed public key\n * in the payload key `public_keys`.\n *\n * @param  {String} token encoded and signed authentication token\n * @return {Boolean} Returns `true` if the signature matches the claimed public key\n * @throws {Error} if `token` contains multiple public keys\n * @private\n * @ignore\n */\nexport function doSignaturesMatchPublicKeys(token: string): boolean {\n  const payload = decodeToken(token).payload;\n  if (typeof payload === 'string') {\n    throw new Error('Unexpected token payload type of string');\n  }\n  const publicKeys = payload.public_keys as string[];\n  if (publicKeys.length === 1) {\n    const publicKey = publicKeys[0];\n    try {\n      const tokenVerifier = new TokenVerifier('ES256k', publicKey);\n      return tokenVerifier.verify(token);\n    } catch (e) {\n      return false;\n    }\n  } else {\n    throw new Error('Multiple public keys are not supported');\n  }\n}\n\n/**\n * Makes sure that the identity address portion of\n * the decentralized identifier passed in the issuer `iss`\n * key of the token matches the public key\n *\n * @param  {String} token encoded and signed authentication token\n * @return {Boolean} if the identity address and public keys match\n * @throws {Error} if ` token` has multiple public keys\n * @private\n * @ignore\n */\nexport function doPublicKeysMatchIssuer(token: string): boolean {\n  const payload = decodeToken(token).payload;\n  if (typeof payload === 'string') {\n    throw new Error('Unexpected token payload type of string');\n  }\n  const publicKeys = payload.public_keys as string[];\n  const addressFromIssuer = getAddressFromDID(payload.iss);\n\n  if (publicKeys.length === 1) {\n    const addressFromPublicKeys = publicKeyToAddress(publicKeys[0]);\n    if (addressFromPublicKeys === addressFromIssuer) {\n      return true;\n    }\n  } else {\n    throw new Error('Multiple public keys are not supported');\n  }\n\n  return false;\n}\n\n/**\n * Looks up the identity address that owns the claimed username\n * in `token` using the lookup endpoint provided in `nameLookupURL`\n * to determine if the username is owned by the identity address\n * that matches the claimed public key\n *\n * @param  {String} token  encoded and signed authentication token\n * @param  {String} nameLookupURL a URL to the name lookup endpoint of the Blockstack Core API\n * @return {Promise<Boolean>} returns a `Promise` that resolves to\n * `true` if the username is owned by the public key, otherwise the\n * `Promise` resolves to `false`\n * @private\n * @ignore\n */\nexport async function doPublicKeysMatchUsername(\n  token: string,\n  nameLookupURL: string\n): Promise<boolean> {\n  try {\n    const payload = decodeToken(token).payload;\n    if (typeof payload === 'string') {\n      throw new Error('Unexpected token payload type of string');\n    }\n    if (!payload.username) {\n      return true;\n    }\n\n    if (payload.username === null) {\n      return true;\n    }\n\n    if (nameLookupURL === null) {\n      return false;\n    }\n\n    const username = payload.username;\n    const url = `${nameLookupURL.replace(/\\/$/, '')}/${username}`;\n    const response = await fetchPrivate(url);\n    const responseText = await response.text();\n    const responseJSON = JSON.parse(responseText);\n    if (responseJSON.hasOwnProperty('address')) {\n      const nameOwningAddress = responseJSON.address;\n      const addressFromIssuer = getAddressFromDID(payload.iss);\n      if (nameOwningAddress === addressFromIssuer) {\n        return true;\n      } else {\n        return false;\n      }\n    } else {\n      return false;\n    }\n  } catch (error) {\n    console.log(error);\n    console.log('Error checking `doPublicKeysMatchUsername`');\n    return false;\n  }\n}\n\n/**\n * Checks if the if the token issuance time and date is after the\n * current time and date.\n *\n * @param  {String}  token encoded and signed authentication token\n * @return {Boolean} `true` if the token was issued after the current time,\n * otherwise returns `false`\n * @private\n * @ignore\n */\nexport function isIssuanceDateValid(token: string) {\n  const payload = decodeToken(token).payload;\n  if (typeof payload === 'string') {\n    throw new Error('Unexpected token payload type of string');\n  }\n  if (payload.iat) {\n    if (typeof payload.iat !== 'number') {\n      return false;\n    }\n    const issuedAt = new Date(payload.iat * 1000); // JWT times are in seconds\n    if (new Date().getTime() < issuedAt.getTime()) {\n      return false;\n    } else {\n      return true;\n    }\n  } else {\n    return true;\n  }\n}\n\n/**\n * Checks if the expiration date of the `token` is before the current time\n * @param  {String}  token encoded and signed authentication token\n * @return {Boolean} `true` if the `token` has not yet expired, `false`\n * if the `token` has expired\n *\n * @private\n * @ignore\n */\nexport function isExpirationDateValid(token: string) {\n  const payload = decodeToken(token).payload;\n  if (typeof payload === 'string') {\n    throw new Error('Unexpected token payload type of string');\n  }\n  if (payload.exp) {\n    if (typeof payload.exp !== 'number') {\n      return false;\n    }\n    const expiresAt = new Date(payload.exp * 1000); // JWT times are in seconds\n    if (new Date().getTime() > expiresAt.getTime()) {\n      return false;\n    } else {\n      return true;\n    }\n  } else {\n    return true;\n  }\n}\n\n/**\n * Makes sure the `manifest_uri` is a same origin absolute URL.\n * @param  {String}  token encoded and signed authentication token\n * @return {Boolean} `true` if valid, otherwise `false`\n * @private\n * @ignore\n */\nexport function isManifestUriValid(token: string) {\n  const payload = decodeToken(token).payload;\n  if (typeof payload === 'string') {\n    throw new Error('Unexpected token payload type of string');\n  }\n  return isSameOriginAbsoluteUrl(payload.domain_name as string, payload.manifest_uri as string);\n}\n\n/**\n * Makes sure the `redirect_uri` is a same origin absolute URL.\n * @param  {String}  token encoded and signed authentication token\n * @return {Boolean} `true` if valid, otherwise `false`\n * @private\n * @ignore\n */\nexport function isRedirectUriValid(token: string) {\n  const payload = decodeToken(token).payload;\n  if (typeof payload === 'string') {\n    throw new Error('Unexpected token payload type of string');\n  }\n  return isSameOriginAbsoluteUrl(payload.domain_name as string, payload.redirect_uri as string);\n}\n\n/**\n * Verify authentication request is valid. This function performs a number\n * of checks on the authentication request token:\n * * Checks that `token` has a valid issuance date & is not expired\n * * Checks that `token` has a valid signature that matches the public key it claims\n * * Checks that both the manifest and redirect URLs are absolute and conform to\n * the same origin policy\n *\n * @param  {String} token encoded and signed authentication request token\n * @return {Promise} that resolves to true if the auth request\n *  is valid and false if it does not. It rejects with a String if the\n *  token is not signed\n * @private\n * @ignore\n */\nexport async function verifyAuthRequest(token: string): Promise<boolean> {\n  if (decodeToken(token).header.alg === 'none') {\n    throw new Error('Token must be signed in order to be verified');\n  }\n  const values = await Promise.all([\n    isExpirationDateValid(token),\n    isIssuanceDateValid(token),\n    doSignaturesMatchPublicKeys(token),\n    doPublicKeysMatchIssuer(token),\n    isManifestUriValid(token),\n    isRedirectUriValid(token),\n  ]);\n  return values.every(val => val);\n}\n\n/**\n * Verify the authentication request is valid and\n * fetch the app manifest file if valid. Otherwise, reject the promise.\n * @param  {String} token encoded and signed authentication request token\n * @return {Promise} that resolves to the app manifest file in JSON format\n * or rejects if the auth request or app manifest file is invalid\n * @private\n * @ignore\n */\nexport async function verifyAuthRequestAndLoadManifest(token: string): Promise<any> {\n  const valid = await verifyAuthRequest(token);\n  if (!valid) {\n    throw new Error('Token is an invalid auth request');\n  }\n  return fetchAppManifest(token);\n}\n\n/**\n * Verify the authentication response is valid\n * @param {String} token the authentication response token\n * @param {String} nameLookupURL the url use to verify owner of a username\n * @return {Promise} that resolves to true if auth response\n * is valid and false if it does not\n * @private\n * @ignore\n */\nexport async function verifyAuthResponse(token: string, nameLookupURL: string): Promise<boolean> {\n  const values = await Promise.all([\n    isExpirationDateValid(token),\n    isIssuanceDateValid(token),\n    doSignaturesMatchPublicKeys(token),\n    doPublicKeysMatchIssuer(token),\n    doPublicKeysMatchUsername(token, nameLookupURL),\n  ]);\n  return values.every(val => val);\n}\n","import { InvalidStateError } from '@stacks/common';\nimport { UserData } from './userData';\n\nconst SESSION_VERSION = '1.0.0';\n\ntype EtagMap = { [key: string]: string };\n\nexport interface SessionOptions {\n  coreNode?: string;\n  userData?: UserData;\n  transitKey?: string;\n  etags?: EtagMap;\n  localStorageKey?: string;\n  storeOptions?: {\n    localStorageKey?: string;\n  };\n}\n\n/**\n * @ignore\n */\nexport class SessionData {\n  version: string;\n\n  transitKey?: string;\n\n  // using this in place of\n  // window.localStorage.setItem(BLOCKSTACK_STORAGE_LABEL, JSON.stringify(userData))\n  userData?: UserData;\n\n  etags?: EtagMap;\n\n  constructor(options: SessionOptions) {\n    this.version = SESSION_VERSION;\n    this.userData = options.userData;\n    this.transitKey = options.transitKey;\n    this.etags = options.etags ? options.etags : {};\n  }\n\n  // getGaiaHubConfig(): GaiaHubConfig {\n  //   return this.userData && this.userData.gaiaHubConfig\n  // }\n\n  // setGaiaHubConfig(config: GaiaHubConfig): void {\n  //   this.userData.gaiaHubConfig = config\n  // }\n\n  static fromJSON(json: any): SessionData {\n    if (json.version !== SESSION_VERSION) {\n      throw new InvalidStateError(`JSON data version ${json.version} not supported by SessionData`);\n    }\n    const options: SessionOptions = {\n      coreNode: json.coreNode,\n      userData: json.userData,\n      transitKey: json.transitKey,\n      etags: json.etags,\n    };\n    return new SessionData(options);\n  }\n\n  toString(): string {\n    return JSON.stringify(this);\n  }\n}\n","import { SessionData, SessionOptions } from './sessionData';\nimport { LOCALSTORAGE_SESSION_KEY } from './constants';\nimport { NoSessionDataError } from '@stacks/common';\n\n/**\n * An abstract class representing the SessionDataStore interface.\n\n */\nexport class SessionDataStore {\n  constructor(sessionOptions?: SessionOptions) {\n    if (sessionOptions) {\n      const newSessionData = new SessionData(sessionOptions);\n      this.setSessionData(newSessionData);\n    }\n  }\n\n  getSessionData(): SessionData {\n    throw new Error('Abstract class');\n  }\n\n  /* eslint-disable */\n  // @ts-ignore\n  // TODO: fix, not used?\n  setSessionData(session: SessionData): boolean {\n    throw new Error('Abstract class');\n  }\n\n  deleteSessionData(): boolean {\n    throw new Error('Abstract class');\n  }\n  /* eslint-enable */\n}\n\n/**\n * Stores session data in the instance of this class.\n * @ignore\n */\nexport class InstanceDataStore extends SessionDataStore {\n  sessionData?: SessionData;\n\n  constructor(sessionOptions?: SessionOptions) {\n    super(sessionOptions);\n    if (!this.sessionData) {\n      this.setSessionData(new SessionData({}));\n    }\n  }\n\n  getSessionData(): SessionData {\n    if (!this.sessionData) {\n      throw new NoSessionDataError('No session data was found.');\n    }\n    return this.sessionData;\n  }\n\n  setSessionData(session: SessionData): boolean {\n    this.sessionData = session;\n    return true;\n  }\n\n  deleteSessionData(): boolean {\n    this.setSessionData(new SessionData({}));\n    return true;\n  }\n}\n\n/**\n * Stores session data in browser a localStorage entry.\n * @ignore\n */\nexport class LocalStorageStore extends SessionDataStore {\n  key: string;\n\n  constructor(sessionOptions?: SessionOptions) {\n    super(sessionOptions);\n    if (\n      sessionOptions &&\n      sessionOptions.storeOptions &&\n      sessionOptions.storeOptions.localStorageKey &&\n      typeof sessionOptions.storeOptions.localStorageKey === 'string'\n    ) {\n      this.key = sessionOptions.storeOptions.localStorageKey;\n    } else {\n      this.key = LOCALSTORAGE_SESSION_KEY;\n    }\n\n    const data = localStorage.getItem(this.key);\n    if (!data) {\n      const sessionData = new SessionData({});\n      this.setSessionData(sessionData);\n    }\n  }\n\n  getSessionData(): SessionData {\n    const data = localStorage.getItem(this.key);\n    if (!data) {\n      throw new NoSessionDataError('No session data was found in localStorage');\n    }\n    const dataJSON = JSON.parse(data);\n    return SessionData.fromJSON(dataJSON);\n  }\n\n  setSessionData(session: SessionData): boolean {\n    localStorage.setItem(this.key, session.toString());\n    return true;\n  }\n\n  deleteSessionData(): boolean {\n    localStorage.removeItem(this.key);\n    this.setSessionData(new SessionData({}));\n    return true;\n  }\n}\n","/**\n * This logic is in a separate file with no dependencies so that it can be\n * loaded and executed as soon as possible to fulfill the purpose of the protocol\n * detection technique. The effectiveness of this is obviously subject to how web\n * apps bundle/consume the blockstack.js lib.\n */\n\nconst GLOBAL_DETECTION_CACHE_KEY = '_blockstackDidCheckEchoReply';\nconst ECHO_REPLY_PARAM = 'echoReply';\nconst AUTH_CONTINUATION_PARAM = 'authContinuation';\n\nfunction getQueryStringParams(query: string): Record<string, string> {\n  if (!query) {\n    return {};\n  }\n  // Trim a starting `?` character if exists\n  const trimmed = /^[?#]/.test(query) ? query.slice(1) : query;\n  return trimmed.split('&').reduce((params, param) => {\n    const [key, value] = param.split('=');\n    params[key] = value ? decodeURIComponent(value.replace(/\\+/g, ' ')) : '';\n    return params;\n  }, {} as Record<string, string>);\n}\n\n/**\n * Checks if the current window location URL contains an 'echoReply' parameter\n * which indicates that this page was only opened to signal back to the originating\n * tab that the protocol handler is installed.\n * If found, then localStorage events are used to notify the other tab,\n * and this page is redirected back to the Blockstack authenticator URL.\n * This function caches its result and will not trigger multiple redirects when\n * invoked multiple times.\n * @returns True if detected and the page will be automatically redirected.\n * @hidden\n */\nexport function protocolEchoReplyDetection(): boolean {\n  // Check that the `window` APIs exist\n  let globalScope: Window;\n  if (typeof self !== 'undefined') {\n    globalScope = self;\n  } else if (typeof window !== 'undefined') {\n    globalScope = window;\n  } else {\n    // Exit detection function - we are not running in a browser environment.\n    return false;\n  }\n\n  if (!globalScope.location || !globalScope.localStorage) {\n    // Exit detection function - we are not running in a browser environment.\n    return false;\n  }\n\n  // Avoid performing the check twice and triggered multiple redirect timers.\n  const existingDetection = (globalScope as any)[GLOBAL_DETECTION_CACHE_KEY];\n  if (typeof existingDetection === 'boolean') {\n    return existingDetection;\n  }\n\n  const searchParams = getQueryStringParams(globalScope.location.search);\n  const echoReplyParam = searchParams[ECHO_REPLY_PARAM];\n  if (echoReplyParam) {\n    (globalScope as any)[GLOBAL_DETECTION_CACHE_KEY] = true;\n\n    // Use localStorage to notify originated tab that protocol handler is available and working.\n    const echoReplyKey = `echo-reply-${echoReplyParam}`;\n\n    // Set the echo-reply result in localStorage for the other window to see.\n    globalScope.localStorage.setItem(echoReplyKey, 'success');\n\n    // Redirect back to the localhost auth url, as opposed to another protocol launch.\n    // This will re-use the same tab rather than creating another useless one.\n    globalScope.setTimeout(() => {\n      const authContinuationParam = searchParams[AUTH_CONTINUATION_PARAM];\n      globalScope.location.href = authContinuationParam;\n    }, 10);\n\n    return true;\n  }\n\n  return false;\n}\n","import { AppConfig } from './appConfig';\nimport { SessionOptions } from './sessionData';\nimport { InstanceDataStore, LocalStorageStore, SessionDataStore } from './sessionStore';\nimport { decodeToken } from 'jsontokens';\nimport { verifyAuthResponse } from './verification';\nimport * as authMessages from './messages';\nimport {\n  decryptContent,\n  encryptContent,\n  EncryptContentOptions,\n  hexStringToECPair,\n} from '@stacks/encryption';\nimport { getAddressFromDID } from './dids';\nimport {\n  BLOCKSTACK_DEFAULT_GAIA_HUB_URL,\n  fetchPrivate,\n  getGlobalObject,\n  InvalidStateError,\n  isLaterVersion,\n  Logger,\n  LoginFailedError,\n  MissingParameterError,\n  nextHour,\n} from '@stacks/common';\nimport { extractProfile } from '@stacks/profile';\nimport { AuthScope, DEFAULT_PROFILE, NAME_LOOKUP_PATH } from './constants';\nimport * as queryString from 'query-string';\nimport { UserData } from './userData';\nimport { StacksMainnet } from '@stacks/network';\nimport { protocolEchoReplyDetection } from './protocolEchoDetection';\n\n/**\n *\n * Represents an instance of a signed in user for a particular app.\n *\n * A signed in user has access to two major pieces of information\n * about the user, the user's private key for that app and the location\n * of the user's gaia storage bucket for the app.\n *\n * A user can be signed in either directly through the interactive\n * sign in process or by directly providing the app private key.\n *\n\n *\n */\nexport class UserSession {\n  appConfig: AppConfig;\n\n  store: SessionDataStore;\n\n  /**\n   * Creates a UserSession object\n   *\n   * @param options\n   */\n  constructor(options?: {\n    appConfig?: AppConfig;\n    sessionStore?: SessionDataStore;\n    sessionOptions?: SessionOptions;\n  }) {\n    let runningInBrowser = true;\n\n    if (typeof window === 'undefined' && typeof self === 'undefined') {\n      // Logger.debug('UserSession: not running in browser')\n      runningInBrowser = false;\n    }\n\n    if (options && options.appConfig) {\n      this.appConfig = options.appConfig;\n    } else if (runningInBrowser) {\n      this.appConfig = new AppConfig();\n    } else {\n      throw new MissingParameterError('You need to specify options.appConfig');\n    }\n\n    if (options && options.sessionStore) {\n      this.store = options.sessionStore;\n    } else if (runningInBrowser) {\n      if (options) {\n        this.store = new LocalStorageStore(options.sessionOptions);\n      } else {\n        this.store = new LocalStorageStore();\n      }\n    } else if (options) {\n      this.store = new InstanceDataStore(options.sessionOptions);\n    } else {\n      this.store = new InstanceDataStore();\n    }\n  }\n\n  /**\n   * Generates an authentication request that can be sent to the Blockstack\n   * browser for the user to approve sign in. This authentication request can\n   * then be used for sign in by passing it to the [[redirectToSignInWithAuthRequest]]\n   * method.\n   *\n   * *Note*: This method should only be used if you want to use a customized authentication\n   * flow. Typically, you'd use [[redirectToSignIn]] which is the default sign in method.\n   *\n   * @param transitKey A HEX encoded transit private key.\n   * @param redirectURI Location to redirect the user to after sign in approval.\n   * @param manifestURI Location of this app's manifest file.\n   * @param scopes The permissions this app is requesting. The default is `store_write`.\n   * @param appDomain The origin of the app.\n   * @param expiresAt The time at which this request is no longer valid.\n   * @param extraParams Any extra parameters to pass to the authenticator. Use this to\n   * pass options that aren't part of the Blockstack authentication specification,\n   * but might be supported by special authenticators.\n   *\n   * @returns {String} the authentication request\n   */\n  makeAuthRequest(\n    transitKey?: string,\n    redirectURI?: string,\n    manifestURI?: string,\n    scopes?: (AuthScope | string)[],\n    appDomain?: string,\n    expiresAt: number = nextHour().getTime(),\n    extraParams: any = {}\n  ): string {\n    const appConfig = this.appConfig;\n    if (!appConfig) {\n      throw new InvalidStateError('Missing AppConfig');\n    }\n    transitKey = transitKey || this.generateAndStoreTransitKey();\n    redirectURI = redirectURI || appConfig.redirectURI();\n    manifestURI = manifestURI || appConfig.manifestURI();\n    scopes = scopes || appConfig.scopes;\n    appDomain = appDomain || appConfig.appDomain;\n    return authMessages.makeAuthRequest(\n      transitKey,\n      redirectURI,\n      manifestURI,\n      scopes,\n      appDomain,\n      expiresAt,\n      extraParams\n    );\n  }\n\n  /**\n   * Generates a ECDSA keypair to\n   * use as the ephemeral app transit private key\n   * and store in the session.\n   *\n   * @returns {String} the hex encoded private key\n   *\n   */\n  generateAndStoreTransitKey(): string {\n    const sessionData = this.store.getSessionData();\n    const transitKey = authMessages.generateTransitKey();\n    sessionData.transitKey = transitKey;\n    this.store.setSessionData(sessionData);\n    return transitKey;\n  }\n\n  /**\n   * Retrieve the authentication token from the URL query\n   * @return {String} the authentication token if it exists otherwise `null`\n   */\n  getAuthResponseToken(): string {\n    const search = getGlobalObject('location', {\n      throwIfUnavailable: true,\n      usageDesc: 'getAuthResponseToken',\n    })?.search;\n    if (search) {\n      const queryDict = queryString.parse(search);\n      return queryDict.authResponse ? (queryDict.authResponse as string) : '';\n    }\n    return '';\n  }\n\n  /**\n   * Check if there is a authentication request that hasn't been handled.\n   *\n   * Also checks for a protocol echo reply (which if detected then the page\n   * will be automatically redirected after this call).\n   *\n   * @return {Boolean} `true` if there is a pending sign in, otherwise `false`\n   */\n  isSignInPending() {\n    try {\n      const isProtocolEcho = protocolEchoReplyDetection();\n      if (isProtocolEcho) {\n        Logger.info(\n          'protocolEchoReply detected from isSignInPending call, the page is about to redirect.'\n        );\n        return true;\n      }\n    } catch (error) {\n      Logger.error(`Error checking for protocol echo reply isSignInPending: ${error}`);\n    }\n\n    return !!this.getAuthResponseToken();\n  }\n\n  /**\n   * Check if a user is currently signed in.\n   *\n   * @returns {Boolean} `true` if the user is signed in, `false` if not.\n   */\n  isUserSignedIn() {\n    return !!this.store.getSessionData().userData;\n  }\n\n  /**\n   * Try to process any pending sign in request by returning a `Promise` that resolves\n   * to the user data object if the sign in succeeds.\n   *\n   * @param {String} authResponseToken - the signed authentication response token\n   * @returns {Promise} that resolves to the user data object if successful and rejects\n   * if handling the sign in request fails or there was no pending sign in request.\n   */\n  async handlePendingSignIn(\n    authResponseToken: string = this.getAuthResponseToken()\n  ): Promise<UserData> {\n    const sessionData = this.store.getSessionData();\n\n    if (sessionData.userData) {\n      throw new LoginFailedError('Existing user session found.');\n    }\n\n    const transitKey = this.store.getSessionData().transitKey;\n\n    // let nameLookupURL;\n    let coreNode = this.appConfig && this.appConfig.coreNode;\n    if (!coreNode) {\n      const network = new StacksMainnet();\n      coreNode = network.coreApiUrl;\n    }\n\n    const tokenPayload = decodeToken(authResponseToken).payload;\n\n    if (typeof tokenPayload === 'string') {\n      throw new Error('Unexpected token payload type of string');\n    }\n\n    // Section below is removed since the config was never persisted and therefore useless\n\n    // if (isLaterVersion(tokenPayload.version as string, '1.3.0')\n    //    && tokenPayload.blockstackAPIUrl !== null && tokenPayload.blockstackAPIUrl !== undefined) {\n    //   // override globally\n    //   Logger.info(`Overriding ${config.network.blockstackAPIUrl} `\n    //     + `with ${tokenPayload.blockstackAPIUrl}`)\n    //   // TODO: this config is never saved so the user node preference\n    //   // is not respected in later sessions..\n    //   config.network.blockstackAPIUrl = tokenPayload.blockstackAPIUrl as string\n    //   coreNode = tokenPayload.blockstackAPIUrl as string\n    // }\n\n    const nameLookupURL = `${coreNode}${NAME_LOOKUP_PATH}`;\n\n    const isValid = await verifyAuthResponse(authResponseToken, nameLookupURL);\n    if (!isValid) {\n      throw new LoginFailedError('Invalid authentication response.');\n    }\n\n    // TODO: real version handling\n    let appPrivateKey: string = tokenPayload.private_key as string;\n    let coreSessionToken: string = tokenPayload.core_token as string;\n    if (isLaterVersion(tokenPayload.version as string, '1.1.0')) {\n      if (transitKey !== undefined && transitKey != null) {\n        if (tokenPayload.private_key !== undefined && tokenPayload.private_key !== null) {\n          try {\n            // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n            appPrivateKey = (await authMessages.decryptPrivateKey(\n              transitKey,\n              tokenPayload.private_key as string\n            )) as string;\n          } catch (e) {\n            Logger.warn('Failed decryption of appPrivateKey, will try to use as given');\n            try {\n              hexStringToECPair(tokenPayload.private_key as string);\n            } catch (ecPairError) {\n              throw new LoginFailedError(\n                'Failed decrypting appPrivateKey. Usually means' +\n                  ' that the transit key has changed during login.'\n              );\n            }\n          }\n        }\n        if (coreSessionToken !== undefined && coreSessionToken !== null) {\n          try {\n            // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n            coreSessionToken = (await authMessages.decryptPrivateKey(\n              transitKey,\n              coreSessionToken\n            )) as string;\n          } catch (e) {\n            Logger.info('Failed decryption of coreSessionToken, will try to use as given');\n          }\n        }\n      } else {\n        throw new LoginFailedError(\n          'Authenticating with protocol > 1.1.0 requires transit' + ' key, and none found.'\n        );\n      }\n    }\n    let hubUrl = BLOCKSTACK_DEFAULT_GAIA_HUB_URL;\n    let gaiaAssociationToken: string;\n    if (\n      isLaterVersion(tokenPayload.version as string, '1.2.0') &&\n      tokenPayload.hubUrl !== null &&\n      tokenPayload.hubUrl !== undefined\n    ) {\n      hubUrl = tokenPayload.hubUrl as string;\n    }\n    if (\n      isLaterVersion(tokenPayload.version as string, '1.3.0') &&\n      tokenPayload.associationToken !== null &&\n      tokenPayload.associationToken !== undefined\n    ) {\n      gaiaAssociationToken = tokenPayload.associationToken as string;\n    }\n\n    const userData: UserData = {\n      username: tokenPayload.username as string,\n      profile: tokenPayload.profile,\n      email: tokenPayload.email as string,\n      decentralizedID: tokenPayload.iss,\n      identityAddress: getAddressFromDID(tokenPayload.iss),\n      appPrivateKey,\n      coreSessionToken,\n      authResponseToken,\n      hubUrl,\n      coreNode: tokenPayload.blockstackAPIUrl as string,\n      // eslint-disable-next-line @typescript-eslint/ban-ts-ignore\n      // @ts-ignore\n      gaiaAssociationToken,\n    };\n    const profileURL = tokenPayload.profile_url as string;\n    if (!userData.profile && profileURL) {\n      const response = await fetchPrivate(profileURL);\n      if (!response.ok) {\n        // return blank profile if we fail to fetch\n        userData.profile = Object.assign({}, DEFAULT_PROFILE);\n      } else {\n        const responseText = await response.text();\n        const wrappedProfile = JSON.parse(responseText);\n        userData.profile = extractProfile(wrappedProfile[0].token);\n      }\n    } else {\n      userData.profile = tokenPayload.profile;\n    }\n\n    sessionData.userData = userData;\n    this.store.setSessionData(sessionData);\n\n    return userData;\n  }\n\n  /**\n   * Retrieves the user data object. The user's profile is stored in the key [[Profile]].\n   *\n   * @returns {Object} User data object.\n   */\n  loadUserData() {\n    const userData = this.store.getSessionData().userData;\n    if (!userData) {\n      throw new InvalidStateError('No user data found. Did the user sign in?');\n    }\n    return userData;\n  }\n\n  /**\n   * Encrypts the data provided with the app public key.\n   * @param {String|Buffer} content  the data to encrypt\n   * @param options\n   * @param {String} options.publicKey the hex string of the ECDSA public\n   * key to use for encryption. If not provided, will use user's appPrivateKey.\n   *\n   * @returns {String} Stringified ciphertext object\n   */\n  encryptContent(content: string | Buffer, options?: EncryptContentOptions): Promise<string> {\n    const opts = Object.assign({}, options);\n    if (!opts.privateKey) {\n      opts.privateKey = this.loadUserData().appPrivateKey;\n    }\n    return encryptContent(content, opts);\n  }\n\n  /**\n   * Decrypts data encrypted with `encryptContent` with the\n   * transit private key.\n   * @param {String|Buffer} content - encrypted content.\n   * @param options\n   * @param {String} options.privateKey - The hex string of the ECDSA private\n   * key to use for decryption. If not provided, will use user's appPrivateKey.\n   * @returns {String|Buffer} decrypted content.\n   */\n  decryptContent(content: string, options?: { privateKey?: string }): Promise<Buffer | string> {\n    const opts = Object.assign({}, options);\n    if (!opts.privateKey) {\n      opts.privateKey = this.loadUserData().appPrivateKey;\n    }\n    return decryptContent(content, opts);\n  }\n\n  /**\n   * Sign the user out and optionally redirect to given location.\n   * @param  redirectURL\n   * Location to redirect user to after sign out.\n   * Only used in environments with `window` available\n   */\n\n  signUserOut(\n    redirectURL?: string\n    // TODO: this is not used?\n    // caller?: UserSession\n  ) {\n    this.store.deleteSessionData();\n    if (redirectURL) {\n      if (typeof location !== 'undefined' && location.href) {\n        location.href = redirectURL;\n      }\n      // TODO: Invalid left-hand side in assignment expression\n      // // eslint-disable-next-line @typescript-eslint/ban-ts-ignore\n      // // @ts-ignore\n      // getGlobalObject('location', {\n      //   throwIfUnavailable: true,\n      //   usageDesc: 'signUserOut',\n      // })?.href = redirectURL;\n    }\n  }\n}\n","import { resolveZoneFileToProfile } from '@stacks/profile';\nimport { fetchPrivate } from '@stacks/common';\nimport { StacksNetwork, StacksMainnet } from '@stacks/network';\n\nexport interface ProfileLookupOptions {\n  username: string;\n  zoneFileLookupURL?: string;\n  network?: StacksNetwork;\n}\n\n/**\n * Look up a user profile by blockstack ID\n *\n * @param {string} username - The Blockstack ID of the profile to look up\n * @param {string} [zoneFileLookupURL=null] - The URL\n * to use for zonefile lookup. If falsey, lookupProfile will use the\n * blockstack.js [[getNameInfo]] function.\n * @returns {Promise} that resolves to a profile object\n */\nexport function lookupProfile(options: ProfileLookupOptions): Promise<Record<string, any>> {\n  if (!options.username) {\n    return Promise.reject();\n  }\n  let network: StacksNetwork = options.network ? options.network : new StacksMainnet();\n  let lookupPromise;\n  if (options.zoneFileLookupURL) {\n    const url = `${options.zoneFileLookupURL.replace(/\\/$/, '')}/${options.username}`;\n    lookupPromise = fetchPrivate(url).then(response => response.json());\n  } else {\n    lookupPromise = network.getNameInfo(options.username);\n  }\n  return lookupPromise.then((responseJSON: any) => {\n    if (responseJSON.hasOwnProperty('zonefile') && responseJSON.hasOwnProperty('address')) {\n      return resolveZoneFileToProfile(responseJSON.zonefile, responseJSON.address);\n    } else {\n      throw new Error(\n        'Invalid zonefile lookup response: did not contain `address`' + ' or `zonefile` field'\n      );\n    }\n  });\n}\n"],"names":["BLOCKSTACK_HANDLER","BLOCKSTACK_STORAGE_LABEL","DEFAULT_BLOCKSTACK_HOST","DEFAULT_PROFILE","DEFAULT_SCOPE","BLOCKSTACK_APP_PRIVATE_KEY_LABEL","DEFAULT_CORE_NODE","NAME_LOOKUP_PATH","LOCALSTORAGE_SESSION_KEY","AppConfig","scopes","appDomain","redirectPath","manifestPath","coreNode","authenticatorURL","slice","getGlobalObject","returnEmptyObject","origin","undefined","redirectURI","manifestURI","runtime","exports","Op","Object","prototype","hasOwn","hasOwnProperty","$Symbol","Symbol","iteratorSymbol","iterator","asyncIteratorSymbol","asyncIterator","toStringTagSymbol","toStringTag","define","obj","key","value","defineProperty","enumerable","configurable","writable","err","wrap","innerFn","outerFn","self","tryLocsList","protoGenerator","Generator","generator","create","context","Context","_invoke","makeInvokeMethod","tryCatch","fn","arg","type","call","GenStateSuspendedStart","GenStateSuspendedYield","GenStateExecuting","GenStateCompleted","ContinueSentinel","GeneratorFunction","GeneratorFunctionPrototype","IteratorPrototype","getProto","getPrototypeOf","NativeIteratorPrototype","values","Gp","constructor","displayName","defineIteratorMethods","forEach","method","isGeneratorFunction","genFun","ctor","name","mark","setPrototypeOf","__proto__","awrap","__await","AsyncIterator","PromiseImpl","invoke","resolve","reject","record","result","then","unwrapped","error","previousPromise","enqueue","callInvokeWithMethodAndArg","async","Promise","iter","next","done","state","Error","doneResult","delegate","delegateResult","maybeInvokeDelegate","sent","_sent","dispatchException","abrupt","TypeError","info","resultName","nextLoc","toString","pushTryEntry","locs","entry","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","push","resetTryEntry","completion","reset","keys","object","reverse","length","pop","iterable","iteratorMethod","isNaN","i","skipTempReset","prev","charAt","stop","rootEntry","rootRecord","rval","exception","handle","loc","caught","hasCatch","hasFinally","finallyEntry","complete","finish","thrown","delegateYield","module","regeneratorRuntime","accidentalStrictMode","Function","makeDIDFromAddress","address","makeDIDFromPublicKey","publicKey","getDIDType","decentralizedID","didParts","split","InvalidDIDError","toLowerCase","getAddressFromDID","didType","VERSION","generateTransitKey","transitKey","makeECPrivateKey","makeAuthRequest","transitPrivateKey","expiresAt","extraParams","nextMonth","getTime","getWindowOrigin","paramName","location","throwIfUnavailable","usageDesc","payload","assign","jti","makeUUID4","iat","Math","floor","Date","exp","iss","public_keys","domain_name","manifest_uri","redirect_uri","version","do_not_include_profile","supports_hub_url","SECP256K1Client","derivePublicKey","publicKeyToAddress","tokenSigner","TokenSigner","token","sign","encryptPrivateKey","privateKey","encryptECIES","Buffer","from","encryptedObj","encryptedJSON","JSON","stringify","decryptPrivateKey","hexedEncrypted","unhexedString","parse","decryptECIES","decrypted","makeAuthResponse","profile","username","metadata","coreToken","appPrivateKey","transitPublicKey","hubUrl","blockstackAPIUrl","associationToken","privateKeyPayload","coreTokenPayload","additionalProperties","email","profile_url","profileUrl","private_key","core_token","getAuthRequestFromURL","search","queryDict","queryString","authRequest","join","fetchAppManifest","decodeToken","fetchPrivate","response","text","responseText","responseJSON","console","log","doSignaturesMatchPublicKeys","publicKeys","tokenVerifier","TokenVerifier","verify","e","doPublicKeysMatchIssuer","addressFromIssuer","addressFromPublicKeys","doPublicKeysMatchUsername","nameLookupURL","url","replace","nameOwningAddress","isIssuanceDateValid","issuedAt","isExpirationDateValid","isManifestUriValid","isSameOriginAbsoluteUrl","isRedirectUriValid","verifyAuthRequest","header","alg","all","every","val","verifyAuthRequestAndLoadManifest","valid","verifyAuthResponse","SESSION_VERSION","SessionData","options","userData","etags","fromJSON","json","InvalidStateError","SessionDataStore","sessionOptions","newSessionData","setSessionData","getSessionData","session","deleteSessionData","InstanceDataStore","sessionData","NoSessionDataError","LocalStorageStore","storeOptions","localStorageKey","data","localStorage","getItem","dataJSON","setItem","removeItem","GLOBAL_DETECTION_CACHE_KEY","ECHO_REPLY_PARAM","AUTH_CONTINUATION_PARAM","getQueryStringParams","query","trimmed","test","reduce","params","param","decodeURIComponent","protocolEchoReplyDetection","globalScope","window","existingDetection","searchParams","echoReplyParam","echoReplyKey","setTimeout","authContinuationParam","href","UserSession","runningInBrowser","appConfig","MissingParameterError","sessionStore","store","nextHour","generateAndStoreTransitKey","authMessages","getAuthResponseToken","authResponse","isSignInPending","isProtocolEcho","Logger","isUserSignedIn","handlePendingSignIn","authResponseToken","LoginFailedError","network","StacksMainnet","coreApiUrl","tokenPayload","isValid","coreSessionToken","isLaterVersion","warn","hexStringToECPair","BLOCKSTACK_DEFAULT_GAIA_HUB_URL","gaiaAssociationToken","identityAddress","profileURL","ok","wrappedProfile","extractProfile","loadUserData","encryptContent","content","opts","decryptContent","signUserOut","redirectURL","lookupProfile","lookupPromise","zoneFileLookupURL","getNameInfo","resolveZoneFileToProfile","zonefile"],"mappings":"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"}