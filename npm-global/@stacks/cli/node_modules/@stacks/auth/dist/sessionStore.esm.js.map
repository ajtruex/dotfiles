{"version":3,"file":"sessionStore.esm.js","sources":["../src/sessionStore.ts"],"sourcesContent":["import { SessionData, SessionOptions } from './sessionData';\nimport { LOCALSTORAGE_SESSION_KEY } from './constants';\nimport { NoSessionDataError } from '@stacks/common';\n\n/**\n * An abstract class representing the SessionDataStore interface.\n\n */\nexport class SessionDataStore {\n  constructor(sessionOptions?: SessionOptions) {\n    if (sessionOptions) {\n      const newSessionData = new SessionData(sessionOptions);\n      this.setSessionData(newSessionData);\n    }\n  }\n\n  getSessionData(): SessionData {\n    throw new Error('Abstract class');\n  }\n\n  /* eslint-disable */\n  // @ts-ignore\n  // TODO: fix, not used?\n  setSessionData(session: SessionData): boolean {\n    throw new Error('Abstract class');\n  }\n\n  deleteSessionData(): boolean {\n    throw new Error('Abstract class');\n  }\n  /* eslint-enable */\n}\n\n/**\n * Stores session data in the instance of this class.\n * @ignore\n */\nexport class InstanceDataStore extends SessionDataStore {\n  sessionData?: SessionData;\n\n  constructor(sessionOptions?: SessionOptions) {\n    super(sessionOptions);\n    if (!this.sessionData) {\n      this.setSessionData(new SessionData({}));\n    }\n  }\n\n  getSessionData(): SessionData {\n    if (!this.sessionData) {\n      throw new NoSessionDataError('No session data was found.');\n    }\n    return this.sessionData;\n  }\n\n  setSessionData(session: SessionData): boolean {\n    this.sessionData = session;\n    return true;\n  }\n\n  deleteSessionData(): boolean {\n    this.setSessionData(new SessionData({}));\n    return true;\n  }\n}\n\n/**\n * Stores session data in browser a localStorage entry.\n * @ignore\n */\nexport class LocalStorageStore extends SessionDataStore {\n  key: string;\n\n  constructor(sessionOptions?: SessionOptions) {\n    super(sessionOptions);\n    if (\n      sessionOptions &&\n      sessionOptions.storeOptions &&\n      sessionOptions.storeOptions.localStorageKey &&\n      typeof sessionOptions.storeOptions.localStorageKey === 'string'\n    ) {\n      this.key = sessionOptions.storeOptions.localStorageKey;\n    } else {\n      this.key = LOCALSTORAGE_SESSION_KEY;\n    }\n\n    const data = localStorage.getItem(this.key);\n    if (!data) {\n      const sessionData = new SessionData({});\n      this.setSessionData(sessionData);\n    }\n  }\n\n  getSessionData(): SessionData {\n    const data = localStorage.getItem(this.key);\n    if (!data) {\n      throw new NoSessionDataError('No session data was found in localStorage');\n    }\n    const dataJSON = JSON.parse(data);\n    return SessionData.fromJSON(dataJSON);\n  }\n\n  setSessionData(session: SessionData): boolean {\n    localStorage.setItem(this.key, session.toString());\n    return true;\n  }\n\n  deleteSessionData(): boolean {\n    localStorage.removeItem(this.key);\n    this.setSessionData(new SessionData({}));\n    return true;\n  }\n}\n"],"names":["SessionDataStore","sessionOptions","newSessionData","SessionData","setSessionData","getSessionData","Error","session","deleteSessionData","InstanceDataStore","sessionData","NoSessionDataError","LocalStorageStore","storeOptions","localStorageKey","key","LOCALSTORAGE_SESSION_KEY","data","localStorage","getItem","dataJSON","JSON","parse","fromJSON","setItem","toString","removeItem"],"mappings":";;;;;IAQaA,gBAAb;AACE,4BAAYC,cAAZ;AACE,QAAIA,cAAJ,EAAoB;AAClB,UAAMC,cAAc,GAAG,IAAIC,WAAJ,CAAgBF,cAAhB,CAAvB;AACA,WAAKG,cAAL,CAAoBF,cAApB;AACD;AACF;;AANH;;AAAA,SAQEG,cARF,GAQE;AACE,UAAM,IAAIC,KAAJ,CAAU,gBAAV,CAAN;AACD,GAVH;;AAAA,SAeEF,cAfF,GAeE,wBAAeG,OAAf;AACE,UAAM,IAAID,KAAJ,CAAU,gBAAV,CAAN;AACD,GAjBH;;AAAA,SAmBEE,iBAnBF,GAmBE;AACE,UAAM,IAAIF,KAAJ,CAAU,gBAAV,CAAN;AACD,GArBH;;AAAA;AAAA;IA6BaG,iBAAb;AAAA;;AAGE,6BAAYR,cAAZ;;;AACE,yCAAMA,cAAN;;AACA,QAAI,CAAC,MAAKS,WAAV,EAAuB;AACrB,YAAKN,cAAL,CAAoB,IAAID,WAAJ,CAAgB,EAAhB,CAApB;AACD;;;AACF;;AARH;;AAAA,UAUEE,cAVF,GAUE;AACE,QAAI,CAAC,KAAKK,WAAV,EAAuB;AACrB,YAAM,IAAIC,kBAAJ,CAAuB,4BAAvB,CAAN;AACD;;AACD,WAAO,KAAKD,WAAZ;AACD,GAfH;;AAAA,UAiBEN,cAjBF,GAiBE,wBAAeG,OAAf;AACE,SAAKG,WAAL,GAAmBH,OAAnB;AACA,WAAO,IAAP;AACD,GApBH;;AAAA,UAsBEC,iBAtBF,GAsBE;AACE,SAAKJ,cAAL,CAAoB,IAAID,WAAJ,CAAgB,EAAhB,CAApB;AACA,WAAO,IAAP;AACD,GAzBH;;AAAA;AAAA,EAAuCH,gBAAvC;IAgCaY,iBAAb;AAAA;;AAGE,6BAAYX,cAAZ;;;AACE,2CAAMA,cAAN;;AACA,QACEA,cAAc,IACdA,cAAc,CAACY,YADf,IAEAZ,cAAc,CAACY,YAAf,CAA4BC,eAF5B,IAGA,OAAOb,cAAc,CAACY,YAAf,CAA4BC,eAAnC,KAAuD,QAJzD,EAKE;AACA,aAAKC,GAAL,GAAWd,cAAc,CAACY,YAAf,CAA4BC,eAAvC;AACD,KAPD,MAOO;AACL,aAAKC,GAAL,GAAWC,wBAAX;AACD;;AAED,QAAMC,IAAI,GAAGC,YAAY,CAACC,OAAb,CAAqB,OAAKJ,GAA1B,CAAb;;AACA,QAAI,CAACE,IAAL,EAAW;AACT,UAAMP,WAAW,GAAG,IAAIP,WAAJ,CAAgB,EAAhB,CAApB;;AACA,aAAKC,cAAL,CAAoBM,WAApB;AACD;;;AACF;;AArBH;;AAAA,UAuBEL,cAvBF,GAuBE;AACE,QAAMY,IAAI,GAAGC,YAAY,CAACC,OAAb,CAAqB,KAAKJ,GAA1B,CAAb;;AACA,QAAI,CAACE,IAAL,EAAW;AACT,YAAM,IAAIN,kBAAJ,CAAuB,2CAAvB,CAAN;AACD;;AACD,QAAMS,QAAQ,GAAGC,IAAI,CAACC,KAAL,CAAWL,IAAX,CAAjB;AACA,WAAOd,WAAW,CAACoB,QAAZ,CAAqBH,QAArB,CAAP;AACD,GA9BH;;AAAA,UAgCEhB,cAhCF,GAgCE,wBAAeG,OAAf;AACEW,IAAAA,YAAY,CAACM,OAAb,CAAqB,KAAKT,GAA1B,EAA+BR,OAAO,CAACkB,QAAR,EAA/B;AACA,WAAO,IAAP;AACD,GAnCH;;AAAA,UAqCEjB,iBArCF,GAqCE;AACEU,IAAAA,YAAY,CAACQ,UAAb,CAAwB,KAAKX,GAA7B;AACA,SAAKX,cAAL,CAAoB,IAAID,WAAJ,CAAgB,EAAhB,CAApB;AACA,WAAO,IAAP;AACD,GAzCH;;AAAA;AAAA,EAAuCH,gBAAvC;;;;"}